import{w as Ct}from"./with-props-BiwyERrk.js";import{j as e,u as gt,r as l,C as Pt,h as Dt,g as Me,D as Ue}from"./chunk-LSOULM7L-C51OxvVm.js";import{u as ze}from"./AuthContext-D1kUlM0g.js";import{F as me,b as Rt,c as Et,d as Tt,e as Ft,g as At,h as bt,i as It,j as wt,f as qe,k as Wt,l as yt,m as vt,n as Lt,o as $t}from"./index-wHyTX2SO.js";import{u as _,a as Bt}from"./useWinnerRecords-qeyPmgXC.js";import{a as We,g as Ot}from"./getPaginatedParticipants-9gK027T_.js";import{c as Le,a as Mt,d as zt,i as Ne,p as jt,h as Be,b as Oe,g as Vt,e as Ut}from"./useIndexedDB-DB1MSR73.js";const qt="May 21, 2025 at 1:10 PM UTC+8",Ht=({onClick:t})=>e.jsx("div",{className:"settings-button w-full",children:e.jsx("button",{onClick:t,className:"px-4 py-2 hover:bg-[#7d0b1c] rounded-full cursor-pointer w-full",children:"Settings"})});function Kt(){const{logout:t}=ze(),s=gt(),r=()=>{t(),s("/")};return e.jsx("button",{onClick:r,className:"px-4 py-2 hover:bg-[#7d0b1c] rounded-full cursor-pointer",children:"Logout"})}const Nt="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='utf-8'?%3e%3c!--%20Generator:%20Adobe%20Illustrator%2027.5.0,%20SVG%20Export%20Plug-In%20.%20SVG%20Version:%206.00%20Build%200)%20--%3e%3csvg%20version='1.1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20viewBox='0%200%202200%202200'%20style='enable-background:new%200%200%202200%202200;'%20xml:space='preserve'%3e%3cg%20id='Background'%3e%3crect%20style='fill:%23FFFFFF;'%20width='2200'%20height='2200'/%3e%3c/g%3e%3cg%20id='Objects'%3e%3cg%3e%3cpath%20style='fill:%231176FF;'%20d='M1940,1100c0,49.84-4.34,98.66-12.66,146.11C1858.19,1640.38,1514.08,1940,1100,1940%20c-12.72,0-25.37-0.28-37.95-0.84C615.74,1919.31,260,1551.2,260,1100c0-463.92,376.08-840,840-840S1940,636.08,1940,1100z'/%3e%3cpath%20style='fill:%231052E5;'%20d='M1927.34,1246.11C1858.19,1640.38,1514.08,1940,1100,1940c-12.72,0-25.37-0.28-37.95-0.84%20c-187.06-187.1-341.85-342.01-343.06-343.4c-24.36-21.09-37.6-53.25-33.93-86.61c8.15-74.21,31.67-148.08,85.43-181.54%20c99.07-61.65,197.41-87.92,197.41-87.92c3.47-10.78,7.36-46.46,9.4-82.98c-12.55-13.03-24.98-26.63-38.09-39.52%20c-21.18-20.82-26.42-49.21-32.96-84.96c-4.68-2.08-7.35-6.1-9.76-9.78c-0.02-0.03-0.04-0.07-0.07-0.11%20c-4.75-2.06-7.44-6.12-9.87-9.83c-0.02-0.03-0.04-0.07-0.07-0.11c-4.75-2.06-7.44-6.12-9.87-9.82c-2.96-4.54-4.13-9.97-5.23-15.27%20c-3.99-19.07-7.98-38.13-11.96-57.19c-3-14.32-6.01-28.99-3.98-43.48c0.98-6.85,3.41-14.03,9.04-18.06%20c5.62-4.03,15.02-3.06,17.84,3.27c0,0-9.12-89.73-9.12-82.18c-7.62-8.46-13.65-26.88-11.13-41.12%20c2.52-14.23,7.05-28.08,9.31-42.35c2.46-15.68,2.21-31.85,6.71-47.07c6.34-21.45,21.51-39.03,36.95-55.22%20c10.94-11.46,22.25-22.6,34.58-32.53c24.71-19.86,54.16-34.8,85.67-38.33c10.11-1.13,20.31-1.08,30.48-1.03%20c11.4,0.06,22.82,0.11,34.23,0.17c11.41-0.06,22.83-0.11,34.23-0.17c10.17-0.05,20.37-0.1,30.48,1.03%20c31.51,3.53,60.96,18.47,85.67,38.33c10.77,8.67,20.75,18.26,30.39,28.19C1282.78,601.51,1638.99,957.72,1927.34,1246.11z'/%3e%3cpath%20style='fill:%23FFFFFF;'%20d='M1453.46,1612.677C1391.297,1638.104,1279.94,1668,1100,1668s-291.297-29.896-353.46-55.323%20c-41.326-16.903-66.356-59.143-61.483-103.529c8.152-74.208,31.676-148.077,85.437-181.534%20c99.069-61.653,197.409-87.922,197.409-87.922c3.465-10.783,7.359-46.458,9.398-82.984%20c-12.547-13.033-24.982-26.633-38.096-39.521c-24.966-24.536-27.775-59.605-36.687-104.841%20c-16.377,4.655-21.557-3.141-25.905-9.771c-2.963-4.533-4.129-9.965-5.238-15.268c-3.991-19.064-7.974-38.128-11.957-57.192%20c-2.995-14.32-6.007-28.989-3.975-43.479c0.971-6.849,3.408-14.029,9.034-18.06c5.626-4.023,15.025-3.052,17.842,3.27%20c0,0-9.123-89.727-9.123-82.174c-7.618-8.459-13.649-26.884-11.123-41.124c2.518-14.231,7.043-28.082,9.301-42.354%20c2.469-15.672,2.21-31.846,6.711-47.065c6.347-21.452,21.517-39.035,36.954-55.217c10.937-11.463,22.246-22.602,34.583-32.534%20c24.707-19.858,54.157-34.801,85.663-38.331c10.111-1.125,20.311-1.077,30.478-1.028c11.406,0.057,22.82,0.113,34.234,0.17%20c11.414-0.057,22.828-0.113,34.234-0.17c10.167-0.049,20.367-0.097,30.478,1.028c31.506,3.53,60.957,18.473,85.663,38.331%20c12.337,9.933,23.646,21.072,34.583,32.534c15.438,16.182,30.608,33.765,36.954,55.217c4.501,15.219,4.242,31.393,6.711,47.065%20c2.259,14.272,6.784,28.123,9.301,42.354c2.526,14.239-3.505,32.664-11.123,41.124c0-7.553-9.123,82.174-9.123,82.174%20c2.817-6.322,12.216-7.294,17.842-3.27c5.626,4.031,8.063,11.212,9.034,18.06c2.032,14.49-0.979,29.159-3.975,43.479%20c-3.983,19.064-7.966,38.128-11.957,57.192c-1.109,5.302-2.275,10.734-5.238,15.268c-4.347,6.63-9.528,14.426-25.905,9.771%20c-8.913,45.236-11.722,80.304-36.687,104.841c-13.114,12.887-25.548,26.487-38.096,39.521c2.04,36.526,5.934,72.201,9.398,82.984%20c0,0,98.34,26.269,197.409,87.922c53.76,33.457,77.285,107.326,85.437,181.534%20C1519.816,1553.534,1494.786,1595.775,1453.46,1612.677z'/%3e%3c/g%3e%3c/g%3e%3c/svg%3e",Qt=({settingsToggleModal:t})=>{const{user:s}=ze(),[r,n]=l.useState(!1),o=()=>{n(c=>!c)};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{type:"button",className:`flex gap-2 justify-center items-center hover:bg-gray-800 p-1.5   hover:text-white cursor-pointer transition-all duration-200 ${r?"rounded-b-none rounded-t-[18px] bg-gray-950 text-white text-sm":"bg-white text-red-800 rounded-[18px]"}`,onClick:o,children:[e.jsx("img",{src:s!=null&&s.picture?s.picture:Nt,alt:"User avatar",height:25,className:"rounded-full bg-blue-800 overflow-hidden text-xs aspect-square h-[25px]"}),e.jsx("span",{className:"pr-1.5",children:(s==null?void 0:s.first_name)+" "+(s==null?void 0:s.last_name[0])+"."})]}),r&&e.jsxs("div",{className:"dropdown absolute bottom-0 z-[40] translate-y-full bg-gray-950 rounded-2xl min-w-[250px] flex justify-center p-2 flex-col right-0 rounded-tr-none",children:[e.jsx("div",{className:"profile-details w-full justify-center flex items-center py-2 mb-2 bg-gray-800 rounded-xl",children:e.jsx("div",{className:"name text-xl",children:(s==null?void 0:s.first_name)+" "+(s==null?void 0:s.last_name[0])+"."})}),e.jsx(Ht,{onClick:t}),e.jsx(Kt,{})]})]})},Gt=()=>e.jsxs("div",{children:[e.jsxs("span",{className:"text-2xl font-bold",children:[" ","⭕🔴⭕ PLEASE READ LATEST UPDATES ⭕🔴⭕"]}),e.jsx("div",{className:"progress-bar my-4 w-full bg-gray-700 h-[50px] rounded-full p-2",children:e.jsx("div",{className:"progress-fill bg-emerald-500 w-[33%] h-full rounded-full flex justify-center items-center animate-pulse",children:"33%"})}),e.jsx("h1",{children:"New Fixes"}),e.jsxs("ul",{className:"ml-4 mb-4",children:[e.jsx("li",{children:"⭐ User Authentication to Prevent Unautorized Access on Cloud"}),e.jsx("li",{children:"⭐ Restructured Header Buttons"})]}),e.jsx("h1",{children:"Work In Progress (Remaining Issues Only)"}),e.jsxs("ul",{className:" ml-4",children:[e.jsxs("li",{children:["🔴 Conflicting Bugs for Winners Downsync Controllers (API Structure Issue)"," "]}),e.jsx("li",{children:"🔴 Enabling of API Access on CPanel Deployment (Restructuring in-progress)"}),e.jsx("li",{children:"⏳ Pagination Issues"}),e.jsx("li",{children:"⏹️ White Listing of Email Accounts"})]}),e.jsxs("div",{className:"mt-4 text-sm",children:[e.jsx("p",{children:"Legend:"}),e.jsxs("div",{className:"flex gap-4 flex-wrap",children:[e.jsx("span",{children:"⏹️ Not Started Yet"}),e.jsx("span",{children:"⏳ Work In Progress"}),e.jsx("span",{children:"🔴 Fixing Problem"}),e.jsx("span",{children:"✅ Feature Done"}),e.jsx("span",{children:"⭐ New Feature"})]})]}),e.jsxs("h1",{className:"text-emerald-900 mt-5",children:["Estimated Time of Completion:"," ",e.jsx("b",{className:" animate-pulse",children:"5:00 PM - 2025-05-21 (Today) [add 1 hour allowance]"})]})]}),Yt=()=>{const{user:t}=ze();return e.jsxs("div",{children:[e.jsx("span",{className:"text-2xl font-bold",children:"My Account"}),e.jsxs("div",{className:"py-4  px-4 rounded-2xl profile-box text-white bg-gray-700 w-fit flex items-center gap-3 mt-5",children:[e.jsx("div",{className:"profile-pic",children:e.jsx("img",{src:t!=null&&t.picture?t.picture:Nt,className:"img-fluid rounded-full h-[50px]",alt:""})}),e.jsx("div",{className:"full-name text-4xl",children:(t==null?void 0:t.first_name)+" "+(t==null?void 0:t.last_name)})]})]})},Ee="nav-button pt-1.5 text-sm px-4 min-w-[100px] text-center",Te="bg-white text-black rounded-t-xl mb-0 pb-1.5",Fe="bg-transparent text-white pb-1.5 hover:bg-gray-800 rounded-xl mb-1 cursor-pointer",Jt=({isOpen:t,onClose:s})=>{const[r,n]=l.useState("my-account"),o=f=>r===f,c=f=>{if(f===r)return null;n(f)},h=()=>{switch(r){case"my-account":return e.jsx(Yt,{});case"system-updates":return e.jsx(Gt,{});default:return null}};return l.useEffect(()=>{n("system-updates")},[t]),t?e.jsx("div",{className:"fixed inset-0 bg-[rgba(0,0,0,0.4)] z-50 flex items-center justify-center",children:e.jsxs("div",{className:"bg-white rounded-lg h-3/4 min-w-[850px] text-black flex flex-col relative",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"header-content flex-col flex bg-gradient-to-t from-[#000000a4] to-transparent to-60% w-full h-[80px] relative",children:[e.jsxs("h1",{className:"flex flex-col pt-3 text-gray-800 text-xl uppercase font-bold font-[Montserrat] pl-4",children:["Settings"," "]}),e.jsxs("nav",{className:"absolute bottom-0 w-full px-4 flex gap-1",children:[e.jsx("button",{className:`${Ee} ${o("my-account")?Te:Fe}`,onClick:()=>{c("my-account")},children:"My Account"}),e.jsx("button",{className:`${Ee} ${o("email-whitelist")?Te:Fe}`,onClick:()=>{c("email-whitelist")},children:"Email Whitelist"}),e.jsx("button",{className:`${Ee} ${o("system-updates")?Te:Fe}`,onClick:()=>{c("system-updates")},children:"System Updates"}),e.jsx("button",{className:`${Ee} ${o("app-status")?Te:Fe}`,onClick:()=>{c("app-status")},children:"App Status"}),e.jsx("button",{className:`${Ee} ${o("upgrades")?Te:Fe}`,onClick:()=>{c("upgrades")},children:"Upgrades"})]})]}),e.jsx("button",{onClick:s,"aria-label":"Close Modal",className:"exit-button h-[40px] aspect-square text-white font-bold bg-gray-800 rounded-full cursor-pointer hover:bg-gray-700 flex items-center justify-center transition-all duration-200 ease-in-out absolute top-4 right-4",children:e.jsx(me,{icon:Rt,className:"text-2xl"})})]}),e.jsx("div",{className:"grow overflow-y-auto mt-4 px-4",children:h()}),e.jsx("div",{className:"modal-footer text-right text-sm mt-4 flex justify-between p-4",children:e.jsxs("div",{className:"footer-content italic",children:["Last System Update: ",qt]})})]})}):null},Xt=({isPresenting:t})=>{const{user:s}=ze(),[r,n]=l.useState(!1),[o,c]=l.useState(!1),[h,f]=l.useState(!0),x=()=>f(d=>!d);return l.useEffect(()=>{n(!!t)},[t]),l.useEffect(()=>{c(!0);const d=setTimeout(()=>{c(!1),clearTimeout(d)},1e4)},[]),e.jsx(e.Fragment,{children:e.jsx("header",{className:" h-[50px]",children:e.jsxs("div",{className:"flex items-center justify-between px-4 py-2 h-full",children:[e.jsxs("h1",{className:"flex gap-2 items-center",children:[" ",e.jsxs("span",{className:"brand-name text-2xl font-bold",children:[" ","Kopiko Blanca"]}),"Raffle Draw System"]}),e.jsx("nav",{children:e.jsxs("ul",{className:"flex space-x-1 justify-center items-center",children:[e.jsx("li",{children:e.jsx(Jt,{isOpen:h,onClose:x})}),e.jsx("li",{className:`pr-2 transition-all duration-1000 ${o?"translate-y-0":"-translate-y-[100px]"}`,children:s?`Welcome Back, ${s.first_name}! 😊`:""}),e.jsx("li",{children:e.jsx(Qt,{settingsToggleModal:x})})]})}),r?e.jsx("div",{className:"center-div absolute left-1/2 -translate-x-1/2 bg-[#03813c] h-[30px] flex items-center justify-center text-white rounded-xl py-2 px-4 select-none animate-pulse",children:"Presenting..."}):e.jsx("div",{className:"center-div absolute left-1/2 -translate-x-1/2 bg-gray-800 h-[30px] flex items-center justify-center text-white opacity-50 rounded-xl py-2 px-4 select-none",children:"No Presentation"})]})})})},Zt=({isPresenting:t,setIsPresenting:s})=>{const[r]=_("isServerActive"),[n,o]=_("presentingStatus"),[c,h]=_("startDraw",{defaultValue:!1}),[f,x]=_("cloudSyncModalOpen",{defaultValue:!1}),[d,p]=_("activeSyncsTotal",{defaultValue:0}),y=()=>{x(S=>!S)},q=()=>{n==="presenting"?o("not-presenting"):(o("presenting"),window.open("/presenter","_blank","width=1300,height=600,noopener,noreferrer"),h(!1))};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"presenter-controls h-[60px] bg-gray-900 flex justify-between items-center px-3 border-b-1 border-b-gray-600",children:[e.jsx("button",{className:`present-button py-2 px-3 text-sm rounded-xl cursor-pointer ${t?" bg-red-800 hover:bg-red-700":"bg-blue-800 hover:bg-blue-700"}`,onClick:q,type:"button","aria-label":"Start Presentation",children:t?"Stop Presentation":"Start Presentation"}),e.jsxs("button",{className:`pause-presentation h-[40px] text-sm px-3 rounded-2xl  flex items-center justify-center cursor-pointer relative ${r?"bg-emerald-400 hover:bg-emerald-500 animate-pulse text-emerald-800 font-bold":"bg-red-800 hover:bg-red-700 text-red-200"}`,"aria-label":"Server Control",onClick:y,children:[r?"Server Online":"Server Offline",r&&d>0&&e.jsx("div",{className:"number-ball absolute bg-amber-100 text-black text-[12px] font-bold h-[18px] flex justify-center items-center aspect-square rounded-full top-0 right-0 -translate-y-1/4 translate-x-1/4",children:d})]})]})})},es=({setActiveTab:t,activeTab:s})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:"control-panel-nav text-sm flex justify-between items-center ",children:[e.jsxs("button",{className:`${s==="overview"?"active":""}`,onClick:()=>t("overview"),children:[e.jsx("div",{className:"button-icon",children:e.jsx(me,{icon:Et,className:"text-2xl text-white"})}),e.jsx("div",{className:"button-label",children:"Overview"})," "]}),e.jsxs("button",{className:`${s==="raffle"?"active":""}`,onClick:()=>t("raffle"),children:[e.jsx("div",{className:"button-icon",children:e.jsx(me,{icon:Tt,className:"text-2xl text-white"})}),e.jsx("div",{className:"button-label",children:"Raffle"})," "]}),e.jsxs("button",{className:`${s==="presentation"?"active":""}`,onClick:()=>t("presentation"),children:[e.jsx("div",{className:"button-icon",children:e.jsx(me,{icon:Ft,className:"text-2xl text-white"})}),e.jsx("div",{className:"button-label",children:"Presentation"})," "]}),e.jsxs("button",{className:`${s==="configure"?"active":""}`,onClick:()=>t("configure"),children:[e.jsx("div",{className:"button-icon",children:e.jsx(me,{icon:At,className:"text-2xl text-white"})}),e.jsx("div",{className:"button-label",children:"Configure"})," "]})]})});var St={exports:{}};/* @license
Papa Parse
v5.5.2
https://github.com/mholt/PapaParse
License: MIT
*/(function(t,s){((r,n)=>{t.exports=n()})(Pt,function r(){var n=typeof self<"u"?self:typeof window<"u"?window:n!==void 0?n:{},o,c=!n.document&&!!n.postMessage,h=n.IS_PAPA_WORKER||!1,f={},x=0,d={};function p(a){this._handle=null,this._finished=!1,this._completed=!1,this._halted=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},(function(i){var u=v(i);u.chunkSize=parseInt(u.chunkSize),i.step||i.chunk||(u.chunkSize=null),this._handle=new B(u),(this._handle.streamer=this)._config=u}).call(this,a),this.parseChunk=function(i,u){var b=parseInt(this._config.skipFirstNLines)||0;if(this.isFirstChunk&&0<b){let C=this._config.newline;C||(w=this._config.quoteChar||'"',C=this._handle.guessLineEndings(i,w)),i=[...i.split(C).slice(b)].join(C)}this.isFirstChunk&&j(this._config.beforeFirstChunk)&&(w=this._config.beforeFirstChunk(i))!==void 0&&(i=w),this.isFirstChunk=!1,this._halted=!1;var b=this._partialLine+i,w=(this._partialLine="",this._handle.parse(b,this._baseIndex,!this._finished));if(!this._handle.paused()&&!this._handle.aborted()){if(i=w.meta.cursor,b=(this._finished||(this._partialLine=b.substring(i-this._baseIndex),this._baseIndex=i),w&&w.data&&(this._rowCount+=w.data.length),this._finished||this._config.preview&&this._rowCount>=this._config.preview),h)n.postMessage({results:w,workerId:d.WORKER_ID,finished:b});else if(j(this._config.chunk)&&!u){if(this._config.chunk(w,this._handle),this._handle.paused()||this._handle.aborted())return void(this._halted=!0);this._completeResults=w=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(w.data),this._completeResults.errors=this._completeResults.errors.concat(w.errors),this._completeResults.meta=w.meta),this._completed||!b||!j(this._config.complete)||w&&w.meta.aborted||(this._config.complete(this._completeResults,this._input),this._completed=!0),b||w&&w.meta.paused||this._nextChunk(),w}this._halted=!0},this._sendError=function(i){j(this._config.error)?this._config.error(i):h&&this._config.error&&n.postMessage({workerId:d.WORKER_ID,error:i,finished:!1})}}function y(a){var i;(a=a||{}).chunkSize||(a.chunkSize=d.RemoteChunkSize),p.call(this,a),this._nextChunk=c?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(u){this._input=u,this._nextChunk()},this._readChunk=function(){if(this._finished)this._chunkLoaded();else{if(i=new XMLHttpRequest,this._config.withCredentials&&(i.withCredentials=this._config.withCredentials),c||(i.onload=k(this._chunkLoaded,this),i.onerror=k(this._chunkError,this)),i.open(this._config.downloadRequestBody?"POST":"GET",this._input,!c),this._config.downloadRequestHeaders){var u,b=this._config.downloadRequestHeaders;for(u in b)i.setRequestHeader(u,b[u])}var w;this._config.chunkSize&&(w=this._start+this._config.chunkSize-1,i.setRequestHeader("Range","bytes="+this._start+"-"+w));try{i.send(this._config.downloadRequestBody)}catch(C){this._chunkError(C.message)}c&&i.status===0&&this._chunkError()}},this._chunkLoaded=function(){i.readyState===4&&(i.status<200||400<=i.status?this._chunkError():(this._start+=this._config.chunkSize||i.responseText.length,this._finished=!this._config.chunkSize||this._start>=(u=>(u=u.getResponseHeader("Content-Range"))!==null?parseInt(u.substring(u.lastIndexOf("/")+1)):-1)(i),this.parseChunk(i.responseText)))},this._chunkError=function(u){u=i.statusText||u,this._sendError(new Error(u))}}function q(a){(a=a||{}).chunkSize||(a.chunkSize=d.LocalChunkSize),p.call(this,a);var i,u,b=typeof FileReader<"u";this.stream=function(w){this._input=w,u=w.slice||w.webkitSlice||w.mozSlice,b?((i=new FileReader).onload=k(this._chunkLoaded,this),i.onerror=k(this._chunkError,this)):i=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var w=this._input,C=(this._config.chunkSize&&(C=Math.min(this._start+this._config.chunkSize,this._input.size),w=u.call(w,this._start,C)),i.readAsText(w,this._config.encoding));b||this._chunkLoaded({target:{result:C}})},this._chunkLoaded=function(w){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(w.target.result)},this._chunkError=function(){this._sendError(i.error)}}function S(a){var i;p.call(this,a=a||{}),this.stream=function(u){return i=u,this._nextChunk()},this._nextChunk=function(){var u,b;if(!this._finished)return u=this._config.chunkSize,i=u?(b=i.substring(0,u),i.substring(u)):(b=i,""),this._finished=!i,this.parseChunk(b)}}function P(a){p.call(this,a=a||{});var i=[],u=!0,b=!1;this.pause=function(){p.prototype.pause.apply(this,arguments),this._input.pause()},this.resume=function(){p.prototype.resume.apply(this,arguments),this._input.resume()},this.stream=function(w){this._input=w,this._input.on("data",this._streamData),this._input.on("end",this._streamEnd),this._input.on("error",this._streamError)},this._checkIsFinished=function(){b&&i.length===1&&(this._finished=!0)},this._nextChunk=function(){this._checkIsFinished(),i.length?this.parseChunk(i.shift()):u=!0},this._streamData=k(function(w){try{i.push(typeof w=="string"?w:w.toString(this._config.encoding)),u&&(u=!1,this._checkIsFinished(),this.parseChunk(i.shift()))}catch(C){this._streamError(C)}},this),this._streamError=k(function(w){this._streamCleanUp(),this._sendError(w)},this),this._streamEnd=k(function(){this._streamCleanUp(),b=!0,this._streamData("")},this),this._streamCleanUp=k(function(){this._input.removeListener("data",this._streamData),this._input.removeListener("end",this._streamEnd),this._input.removeListener("error",this._streamError)},this)}function B(a){var i,u,b,w,C=Math.pow(2,53),H=-C,se=/^\s*-?(\d+\.?|\.\d+|\d+\.\d+)([eE][-+]?\d+)?\s*$/,ee=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/,I=this,Y=0,R=0,te=!1,E=!1,V=[],N={data:[],errors:[],meta:{}};function ne(z){return a.skipEmptyLines==="greedy"?z.join("").trim()==="":z.length===1&&z[0].length===0}function M(){if(N&&b&&(ue("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+d.DefaultDelimiter+"'"),b=!1),a.skipEmptyLines&&(N.data=N.data.filter(function(F){return!ne(F)})),oe()){let F=function(J,ie){j(a.transformHeader)&&(J=a.transformHeader(J,ie)),V.push(J)};if(N)if(Array.isArray(N.data[0])){for(var z=0;oe()&&z<N.data.length;z++)N.data[z].forEach(F);N.data.splice(0,1)}else N.data.forEach(F)}function L(F,J){for(var ie=a.header?{}:[],K=0;K<F.length;K++){var Q=K,U=F[K],U=(($,g)=>(W=>(a.dynamicTypingFunction&&a.dynamicTyping[W]===void 0&&(a.dynamicTyping[W]=a.dynamicTypingFunction(W)),(a.dynamicTyping[W]||a.dynamicTyping)===!0))($)?g==="true"||g==="TRUE"||g!=="false"&&g!=="FALSE"&&((W=>{if(se.test(W)&&(W=parseFloat(W),H<W&&W<C))return 1})(g)?parseFloat(g):ee.test(g)?new Date(g):g===""?null:g):g)(Q=a.header?K>=V.length?"__parsed_extra":V[K]:Q,U=a.transform?a.transform(U,Q):U);Q==="__parsed_extra"?(ie[Q]=ie[Q]||[],ie[Q].push(U)):ie[Q]=U}return a.header&&(K>V.length?ue("FieldMismatch","TooManyFields","Too many fields: expected "+V.length+" fields but parsed "+K,R+J):K<V.length&&ue("FieldMismatch","TooFewFields","Too few fields: expected "+V.length+" fields but parsed "+K,R+J)),ie}var ae;N&&(a.header||a.dynamicTyping||a.transform)&&(ae=1,!N.data.length||Array.isArray(N.data[0])?(N.data=N.data.map(L),ae=N.data.length):N.data=L(N.data,0),a.header&&N.meta&&(N.meta.fields=V),R+=ae)}function oe(){return a.header&&V.length===0}function ue(z,L,ae,F){z={type:z,code:L,message:ae},F!==void 0&&(z.row=F),N.errors.push(z)}j(a.step)&&(w=a.step,a.step=function(z){N=z,oe()?M():(M(),N.data.length!==0&&(Y+=z.data.length,a.preview&&Y>a.preview?u.abort():(N.data=N.data[0],w(N,I))))}),this.parse=function(z,L,ae){var F=a.quoteChar||'"',F=(a.newline||(a.newline=this.guessLineEndings(z,F)),b=!1,a.delimiter?j(a.delimiter)&&(a.delimiter=a.delimiter(z),N.meta.delimiter=a.delimiter):((F=((J,ie,K,Q,U)=>{var $,g,W,xe;U=U||[",","	","|",";",d.RECORD_SEP,d.UNIT_SEP];for(var we=0;we<U.length;we++){for(var be,ge=U[we],ce=0,de=0,X=0,G=(W=void 0,new A({comments:Q,delimiter:ge,newline:ie,preview:10}).parse(J)),ye=0;ye<G.data.length;ye++)K&&ne(G.data[ye])?X++:(be=G.data[ye].length,de+=be,W===void 0?W=be:0<be&&(ce+=Math.abs(be-W),W=be));0<G.data.length&&(de/=G.data.length-X),(g===void 0||ce<=g)&&(xe===void 0||xe<de)&&1.99<de&&(g=ce,$=ge,xe=de)}return{successful:!!(a.delimiter=$),bestDelimiter:$}})(z,a.newline,a.skipEmptyLines,a.comments,a.delimitersToGuess)).successful?a.delimiter=F.bestDelimiter:(b=!0,a.delimiter=d.DefaultDelimiter),N.meta.delimiter=a.delimiter),v(a));return a.preview&&a.header&&F.preview++,i=z,u=new A(F),N=u.parse(i,L,ae),M(),te?{meta:{paused:!0}}:N||{meta:{paused:!1}}},this.paused=function(){return te},this.pause=function(){te=!0,u.abort(),i=j(a.chunk)?"":i.substring(u.getCharIndex())},this.resume=function(){I.streamer._halted?(te=!1,I.streamer.parseChunk(i,!0)):setTimeout(I.resume,3)},this.aborted=function(){return E},this.abort=function(){E=!0,u.abort(),N.meta.aborted=!0,j(a.complete)&&a.complete(N),i=""},this.guessLineEndings=function(J,F){J=J.substring(0,1048576);var F=new RegExp(m(F)+"([^]*?)"+m(F),"gm"),ae=(J=J.replace(F,"")).split("\r"),F=J.split(`
`),J=1<F.length&&F[0].length<ae[0].length;if(ae.length===1||J)return`
`;for(var ie=0,K=0;K<ae.length;K++)ae[K][0]===`
`&&ie++;return ie>=ae.length/2?`\r
`:"\r"}}function m(a){return a.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function A(a){var i=(a=a||{}).delimiter,u=a.newline,b=a.comments,w=a.step,C=a.preview,H=a.fastMode,se=null,ee=!1,I=a.quoteChar==null?'"':a.quoteChar,Y=I;if(a.escapeChar!==void 0&&(Y=a.escapeChar),(typeof i!="string"||-1<d.BAD_DELIMITERS.indexOf(i))&&(i=","),b===i)throw new Error("Comment character same as delimiter");b===!0?b="#":(typeof b!="string"||-1<d.BAD_DELIMITERS.indexOf(b))&&(b=!1),u!==`
`&&u!=="\r"&&u!==`\r
`&&(u=`
`);var R=0,te=!1;this.parse=function(E,V,N){if(typeof E!="string")throw new Error("Input must be a string");var ne=E.length,M=i.length,oe=u.length,ue=b.length,z=j(w),L=[],ae=[],F=[],J=R=0;if(!E)return ce();if(H||H!==!1&&E.indexOf(I)===-1){for(var ie=E.split(u),K=0;K<ie.length;K++){if(F=ie[K],R+=F.length,K!==ie.length-1)R+=u.length;else if(N)return ce();if(!b||F.substring(0,ue)!==b){if(z){if(L=[],xe(F.split(i)),de(),te)return ce()}else xe(F.split(i));if(C&&C<=K)return L=L.slice(0,C),ce(!0)}}return ce()}for(var Q=E.indexOf(i,R),U=E.indexOf(u,R),$=new RegExp(m(Y)+m(I),"g"),g=E.indexOf(I,R);;)if(E[R]===I)for(g=R,R++;;){if((g=E.indexOf(I,g+1))===-1)return N||ae.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:L.length,index:R}),be();if(g===ne-1)return be(E.substring(R,g).replace($,I));if(I===Y&&E[g+1]===Y)g++;else if(I===Y||g===0||E[g-1]!==Y){Q!==-1&&Q<g+1&&(Q=E.indexOf(i,g+1));var W=we((U=U!==-1&&U<g+1?E.indexOf(u,g+1):U)===-1?Q:Math.min(Q,U));if(E.substr(g+1+W,M)===i){F.push(E.substring(R,g).replace($,I)),E[R=g+1+W+M]!==I&&(g=E.indexOf(I,R)),Q=E.indexOf(i,R),U=E.indexOf(u,R);break}if(W=we(U),E.substring(g+1+W,g+1+W+oe)===u){if(F.push(E.substring(R,g).replace($,I)),ge(g+1+W+oe),Q=E.indexOf(i,R),g=E.indexOf(I,R),z&&(de(),te))return ce();if(C&&L.length>=C)return ce(!0);break}ae.push({type:"Quotes",code:"InvalidQuotes",message:"Trailing quote on quoted field is malformed",row:L.length,index:R}),g++}}else if(b&&F.length===0&&E.substring(R,R+ue)===b){if(U===-1)return ce();R=U+oe,U=E.indexOf(u,R),Q=E.indexOf(i,R)}else if(Q!==-1&&(Q<U||U===-1))F.push(E.substring(R,Q)),R=Q+M,Q=E.indexOf(i,R);else{if(U===-1)break;if(F.push(E.substring(R,U)),ge(U+oe),z&&(de(),te))return ce();if(C&&L.length>=C)return ce(!0)}return be();function xe(X){L.push(X),J=R}function we(X){var G=0;return G=X!==-1&&(X=E.substring(g+1,X))&&X.trim()===""?X.length:G}function be(X){return N||(X===void 0&&(X=E.substring(R)),F.push(X),R=ne,xe(F),z&&de()),ce()}function ge(X){R=X,xe(F),F=[],U=E.indexOf(u,R)}function ce(X){if(a.header&&!V&&L.length&&!ee){var G=L[0],ye={},Z=new Set(G);let fe=!1;for(let ke=0;ke<G.length;ke++){let ve=G[ke];if(ye[ve=j(a.transformHeader)?a.transformHeader(ve,ke):ve]){let _e,De=ye[ve];for(;_e=ve+"_"+De,De++,Z.has(_e););Z.add(_e),G[ke]=_e,ye[ve]++,fe=!0,(se=se===null?{}:se)[_e]=ve}else ye[ve]=1,G[ke]=ve;Z.add(ve)}fe&&console.warn("Duplicate headers found and renamed."),ee=!0}return{data:L,errors:ae,meta:{delimiter:i,linebreak:u,aborted:te,truncated:!!X,cursor:J+(V||0),renamedHeaders:se}}}function de(){w(ce()),L=[],ae=[]}},this.abort=function(){te=!0},this.getCharIndex=function(){return R}}function T(a){var i=a.data,u=f[i.workerId],b=!1;if(i.error)u.userError(i.error,i.file);else if(i.results&&i.results.data){var w={abort:function(){b=!0,O(i.workerId,{data:[],errors:[],meta:{aborted:!0}})},pause:D,resume:D};if(j(u.userStep)){for(var C=0;C<i.results.data.length&&(u.userStep({data:i.results.data[C],errors:i.results.errors,meta:i.results.meta},w),!b);C++);delete i.results}else j(u.userChunk)&&(u.userChunk(i.results,w,i.file),delete i.results)}i.finished&&!b&&O(i.workerId,i.results)}function O(a,i){var u=f[a];j(u.userComplete)&&u.userComplete(i),u.terminate(),delete f[a]}function D(){throw new Error("Not implemented.")}function v(a){if(typeof a!="object"||a===null)return a;var i,u=Array.isArray(a)?[]:{};for(i in a)u[i]=v(a[i]);return u}function k(a,i){return function(){a.apply(i,arguments)}}function j(a){return typeof a=="function"}return d.parse=function(a,i){var u=(i=i||{}).dynamicTyping||!1;if(j(u)&&(i.dynamicTypingFunction=u,u={}),i.dynamicTyping=u,i.transform=!!j(i.transform)&&i.transform,!i.worker||!d.WORKERS_SUPPORTED)return u=null,d.NODE_STREAM_INPUT,typeof a=="string"?(a=(b=>b.charCodeAt(0)!==65279?b:b.slice(1))(a),u=new(i.download?y:S)(i)):a.readable===!0&&j(a.read)&&j(a.on)?u=new P(i):(n.File&&a instanceof File||a instanceof Object)&&(u=new q(i)),u.stream(a);(u=(()=>{var b;return!!d.WORKERS_SUPPORTED&&(b=(()=>{var w=n.URL||n.webkitURL||null,C=r.toString();return d.BLOB_URL||(d.BLOB_URL=w.createObjectURL(new Blob(["var global = (function() { if (typeof self !== 'undefined') { return self; } if (typeof window !== 'undefined') { return window; } if (typeof global !== 'undefined') { return global; } return {}; })(); global.IS_PAPA_WORKER=true; ","(",C,")();"],{type:"text/javascript"})))})(),(b=new n.Worker(b)).onmessage=T,b.id=x++,f[b.id]=b)})()).userStep=i.step,u.userChunk=i.chunk,u.userComplete=i.complete,u.userError=i.error,i.step=j(i.step),i.chunk=j(i.chunk),i.complete=j(i.complete),i.error=j(i.error),delete i.worker,u.postMessage({input:a,config:i,workerId:u.id})},d.unparse=function(a,i){var u=!1,b=!0,w=",",C=`\r
`,H='"',se=H+H,ee=!1,I=null,Y=!1,R=((()=>{if(typeof i=="object"){if(typeof i.delimiter!="string"||d.BAD_DELIMITERS.filter(function(V){return i.delimiter.indexOf(V)!==-1}).length||(w=i.delimiter),typeof i.quotes!="boolean"&&typeof i.quotes!="function"&&!Array.isArray(i.quotes)||(u=i.quotes),typeof i.skipEmptyLines!="boolean"&&typeof i.skipEmptyLines!="string"||(ee=i.skipEmptyLines),typeof i.newline=="string"&&(C=i.newline),typeof i.quoteChar=="string"&&(H=i.quoteChar),typeof i.header=="boolean"&&(b=i.header),Array.isArray(i.columns)){if(i.columns.length===0)throw new Error("Option columns is empty");I=i.columns}i.escapeChar!==void 0&&(se=i.escapeChar+H),i.escapeFormulae instanceof RegExp?Y=i.escapeFormulae:typeof i.escapeFormulae=="boolean"&&i.escapeFormulae&&(Y=/^[=+\-@\t\r].*$/)}})(),new RegExp(m(H),"g"));if(typeof a=="string"&&(a=JSON.parse(a)),Array.isArray(a)){if(!a.length||Array.isArray(a[0]))return te(null,a,ee);if(typeof a[0]=="object")return te(I||Object.keys(a[0]),a,ee)}else if(typeof a=="object")return typeof a.data=="string"&&(a.data=JSON.parse(a.data)),Array.isArray(a.data)&&(a.fields||(a.fields=a.meta&&a.meta.fields||I),a.fields||(a.fields=Array.isArray(a.data[0])?a.fields:typeof a.data[0]=="object"?Object.keys(a.data[0]):[]),Array.isArray(a.data[0])||typeof a.data[0]=="object"||(a.data=[a.data])),te(a.fields||[],a.data||[],ee);throw new Error("Unable to serialize unrecognized input");function te(V,N,ne){var M="",oe=(typeof V=="string"&&(V=JSON.parse(V)),typeof N=="string"&&(N=JSON.parse(N)),Array.isArray(V)&&0<V.length),ue=!Array.isArray(N[0]);if(oe&&b){for(var z=0;z<V.length;z++)0<z&&(M+=w),M+=E(V[z],z);0<N.length&&(M+=C)}for(var L=0;L<N.length;L++){var ae=(oe?V:N[L]).length,F=!1,J=oe?Object.keys(N[L]).length===0:N[L].length===0;if(ne&&!oe&&(F=ne==="greedy"?N[L].join("").trim()==="":N[L].length===1&&N[L][0].length===0),ne==="greedy"&&oe){for(var ie=[],K=0;K<ae;K++){var Q=ue?V[K]:K;ie.push(N[L][Q])}F=ie.join("").trim()===""}if(!F){for(var U=0;U<ae;U++){0<U&&!J&&(M+=w);var $=oe&&ue?V[U]:U;M+=E(N[L][$],U)}L<N.length-1&&(!ne||0<ae&&!J)&&(M+=C)}}return M}function E(V,N){var ne,M;return V==null?"":V.constructor===Date?JSON.stringify(V).slice(1,25):(M=!1,Y&&typeof V=="string"&&Y.test(V)&&(V="'"+V,M=!0),ne=V.toString().replace(R,se),(M=M||u===!0||typeof u=="function"&&u(V,N)||Array.isArray(u)&&u[N]||((oe,ue)=>{for(var z=0;z<ue.length;z++)if(-1<oe.indexOf(ue[z]))return!0;return!1})(ne,d.BAD_DELIMITERS)||-1<ne.indexOf(w)||ne.charAt(0)===" "||ne.charAt(ne.length-1)===" ")?H+ne+H:ne)}},d.RECORD_SEP="",d.UNIT_SEP="",d.BYTE_ORDER_MARK="\uFEFF",d.BAD_DELIMITERS=["\r",`
`,'"',d.BYTE_ORDER_MARK],d.WORKERS_SUPPORTED=!c&&!!n.Worker,d.NODE_STREAM_INPUT=1,d.LocalChunkSize=10485760,d.RemoteChunkSize=5242880,d.DefaultDelimiter=",",d.Parser=A,d.ParserHandle=B,d.NetworkStreamer=y,d.FileStreamer=q,d.StringStreamer=S,d.ReadableStreamStreamer=P,n.jQuery&&((o=n.jQuery).fn.parse=function(a){var i=a.config||{},u=[];return this.each(function(C){if(!(o(this).prop("tagName").toUpperCase()==="INPUT"&&o(this).attr("type").toLowerCase()==="file"&&n.FileReader)||!this.files||this.files.length===0)return!0;for(var H=0;H<this.files.length;H++)u.push({file:this.files[H],inputElem:this,instanceConfig:o.extend({},i)})}),b(),this;function b(){if(u.length===0)j(a.complete)&&a.complete();else{var C,H,se,ee,I=u[0];if(j(a.before)){var Y=a.before(I.file,I.inputElem);if(typeof Y=="object"){if(Y.action==="abort")return C="AbortError",H=I.file,se=I.inputElem,ee=Y.reason,void(j(a.error)&&a.error({name:C},H,se,ee));if(Y.action==="skip")return void w();typeof Y.config=="object"&&(I.instanceConfig=o.extend(I.instanceConfig,Y.config))}else if(Y==="skip")return void w()}var R=I.instanceConfig.complete;I.instanceConfig.complete=function(te){j(R)&&R(te,I.file,I.inputElem),w()},d.parse(I.file,I.instanceConfig)}}function w(){u.splice(0,1),b()}}),h&&(n.onmessage=function(a){a=a.data,d.WORKER_ID===void 0&&a&&(d.WORKER_ID=a.workerId),typeof a.input=="string"?n.postMessage({workerId:d.WORKER_ID,results:d.parse(a.input,a.config),finished:!0}):(n.File&&a.input instanceof File||a.input instanceof Object)&&(a=d.parse(a.input,a.config))&&n.postMessage({workerId:d.WORKER_ID,results:a,finished:!0})}),(y.prototype=Object.create(p.prototype)).constructor=y,(q.prototype=Object.create(p.prototype)).constructor=q,(S.prototype=Object.create(S.prototype)).constructor=S,(P.prototype=Object.create(p.prototype)).constructor=P,d})})(St);var ts=St.exports;const Ke=Dt(ts),ss=({children:t,className:s})=>e.jsx("div",{className:`upload-box-header text-lg  w-full mb-4 ${s}`,children:t}),ns=({children:t,className:s})=>e.jsx("div",{className:`grow bg-green h-0 ${s}`,children:t}),as=({children:t,className:s})=>e.jsx("div",{className:`w-full ${s}`,children:t}),rs="w-full p-4 border-dashed rounded-lg border-2 text-center transition-all duration-200 aspect-[5/4] flex flex-col justify-center items-center relative",re=({children:t,className:s,onDragOver:r,onDragLeave:n,onDrop:o})=>e.jsx("div",{className:`${rs} ${s}`,onDragOver:r,onDragLeave:n,onDrop:o,children:t});re.Header=ss;re.Body=ns;re.Footer=as;const is="bg-gray-600 px-4 h-[40px] w-full text-center rounded-xl  mt-2 flex items-center justify-center gap-2",Se=({className:t,children:s,onClick:r,clickable:n=!0})=>{const o=n?"cursor-pointer hover:bg-gray-500":"";return e.jsx("button",{className:`${is} ${t} ${o}`,onClick:r,children:s})},dt=async()=>{try{return(await We.get("/participants/count")).data}catch(t){throw console.error("Error fetching participants count:",t),t}};function ls(t){if(t===0)return"0 B";const s=["B","KB","MB","GB","TB"],r=1024,n=Math.floor(Math.log(t)/Math.log(r)),o=t/Math.pow(r,n);return`${o%1===0?o:o.toFixed(2)} ${s[n]}`}function ut(t){const r=[{label:"d",value:Math.floor(t/86400)},{label:"h",value:Math.floor(t%86400/3600)},{label:"m",value:Math.floor(t%3600/60)},{label:"s",value:t%60}].filter(n=>n.value>0).slice(0,2);return r.length>0?r.map(n=>`${n.value}${n.label}`).join(" "):"0s"}const os=({setFileAttached:t,setFileDetails:s,setUploadStatus:r,uploadStatus:n,setCloudData:o,setTriggerImport:c,setDownloadElapsedTime:h,fileAttached:f})=>{l.useRef(null);const[x]=_("isServerActive"),[d,p]=l.useState(!0),[y,q]=l.useState(!1),[S,P]=l.useState([]),[B,m]=_("withCloudData",{defaultValue:!1}),[A,T]=l.useState(!1),[O,D]=l.useState(0);l.useEffect(()=>{S&&o(S)},[S]);const[v,k]=l.useState("default"),j=l.useRef(null),a=$=>{$.preventDefault(),q(!0),k("catcher")},i=$=>{q(!1),k("default")},[u,b]=l.useState(5),[w,C]=l.useState(!1);l.useEffect(()=>{!f&&j.current&&(j.current.value="")},[f]);const H=async $=>{if(C(!0),$.type==="text/csv"){t($);const g=await Q($);if(g&&d)r("attached"),s({entries:g}),C(!1);else{t(null);let W=4;const xe=setInterval(()=>{C(!1),b(W),W--,W<0&&(clearInterval(xe),p(!0),b(5))},1e3)}}else alert("Please upload a valid CSV file.")},se=async $=>{$.preventDefault(),q(!1),k("default");const g=$.dataTransfer.files;g.length>0&&await H(g[0])},ee=async $=>{const g=$.target.files;g&&g.length>0&&await H(g[0])},[I,Y]=l.useState(60),[R,te]=l.useState(0),[E,V]=l.useState(0),N=l.useRef([]),ne=l.useRef(0),M=l.useRef(Date.now()),oe=10,ue=l.useRef(!1),z=l.useRef(null),L=l.useRef(null),ae=($,g)=>{const W=$/g*100;D(W);const xe=Date.now(),we=ne.current,be=M.current,ge=$-we,ce=xe-be;if(ge>0){const Z=ce/ge;N.current.push(Z),N.current.length>oe&&N.current.shift(),ne.current=$,M.current=xe}const de=N.current.reduce((Z,fe)=>Z+fe,0)/N.current.length,X=g-$,G=de*X,ye=Math.ceil(Math.max(0,G/1e3));Y(ye)};l.useEffect(()=>{const $=setInterval(()=>{ue.current&&Y(g=>Math.max(0,g-1))},1e3);return()=>clearInterval($)},[]);const F=()=>{var $;($=j.current)==null||$.click()},J=()=>{ie(ae)},ie=async $=>{if(!A){T(!0),ue.current=!0,z.current=Date.now(),L.current=setInterval(()=>{if(z.current){const g=Date.now()-z.current,W=Math.floor(g/1e3);te(W),h(W)}},1e3);try{const{total:g}=await dt();let W=[];if(g&&g>0){const we=Math.ceil(g/2500),be=10;let ge=0,ce=1;const de=new Array(we),X=async Z=>(await Ot(Z,2500)).data,G=async()=>{for(;;){const Z=ce++;if(Z>we)return;try{const fe=await X(Z);de[Z-1]=fe,ge+=fe.length,$(ge,g)}catch(fe){console.error(`❌ Failed batch ${Z}:`,fe),de[Z-1]=null}}},ye=Array.from({length:be},()=>G());await Promise.all(ye);for(let Z=0;Z<de.length;Z++)if(de[Z]===null)try{const fe=await X(Z+1);de[Z]=fe,ge+=fe.length,$(ge,g)}catch(fe){console.error(`❌ Retry failed for batch ${Z+1}`,fe),de[Z]=[]}return W=de.flat().sort((Z,fe)=>Z.id_entry-fe.id_entry),console.log("😓😓😓😓😓😓 FINAL DATA: ",W),W.length!==g&&console.warn(`⚠️ Mismatch in expected vs actual data count. Expected: ${g}, Got: ${W.length}`),console.log("✅ All participant data fetched:",W.length),s({entries:W.length}),P(W),W=[],r("processing"),c(!0),T(!1),ue.current=!1,L.current&&(clearInterval(L.current),L.current=null),!0}else return console.warn("⚠️ No participants found."),ue.current=!1,!1}catch(g){return console.error("❌ Error downloading participant data:",g),T(!1),ue.current=!1,L.current&&(clearInterval(L.current),L.current=null),!1}}},K=["id_entry","full_name","raffle_code","regional_location","registered_at"],Q=async $=>new Promise(g=>{let W=0,xe=!1;Ke.parse($,{header:!0,skipEmptyLines:!0,step:(we,be)=>{if(!xe){const ge=we.meta.fields??[],ce=ge.some(X=>!K.includes(X.toLowerCase())),de=ge.length>K.length;if(ce||de){be.abort(),p(!1),g(0);return}p(!0),xe=!0}W++},complete:()=>{g(W)},error:()=>{p(!1),g(0)}})}),U=async()=>{if(x){const{total:$}=await dt();$>0?(m(!0),console.log("With Cloud Data? ",$>0),V($)):m(!1)}else m(!1)};return l.useEffect(()=>{U()},[x]),l.useEffect(()=>()=>{L.current&&clearInterval(L.current)},[]),e.jsx("div",{className:`upload-phase ${n!=="idle"&&"hidden"}`,children:B?e.jsxs(re,{className:"bg-amber-600 overflow-hidden",children:[e.jsxs(re.Body,{className:"flex justify-center items-center flex-col gap-4 z-10",children:[e.jsx("h2",{className:"text-base",children:"Participants Data found in Database "}),E>0?e.jsxs("div",{children:[e.jsxs("p",{children:["Total Participants from cloud:"," ",e.jsx("span",{className:"font-bold",children:E.toLocaleString()})]}),e.jsxs("p",{title:"This estimate is not an accurate computation of exact size. ",children:["Estimated Size:"," ",e.jsx("span",{className:"font-bold",children:ls(E*70)})]})]}):e.jsx("p",{className:"animate-pulse",children:"Loading Total Count of Participants..."}),!A&&e.jsx("p",{children:"Data can be downloaded. Click download button below to start."})]}),e.jsxs(re.Footer,{className:"z-10",children:[A&&e.jsxs("div",{className:"clock justify-between flex",children:[e.jsxs("div",{className:"bg-[#000000b0] p-1 px-2 text-sm rounded-2xl",children:["⏱️ ELT: ",ut(R)]}),e.jsxs("div",{className:"bg-[#000000b0] p-1 px-2 text-sm rounded-2xl",children:["⏳ ETR: ",ut(I)]})]}),e.jsx(Se,{onClick:J,className:"!bg-[#0000009d]",children:A?e.jsxs("span",{className:"animate-pulse",children:["Downloading - Progress: ",O.toFixed(2),"%"]}):"Download Data to this app"})]}),e.jsx("div",{className:"progress-bar-shell absolute top-0 w-full h-full z-[0]",children:e.jsx("div",{className:"progress-bar bg-[#8d600086] w-full h-full",style:{transform:`translateX(-${100-O}%)`}})})]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{onDragOver:a,onDragLeave:i,onDrop:se,className:`${y&&"bg-gray-300 text-gray-800 animate-pulse"}`,children:y?e.jsx("p",{className:"text-xl",children:"Drop CSV File Here"}):e.jsxs(e.Fragment,{children:[e.jsxs(re.Body,{className:"flex justify-center items-center flex-col gap-4",children:[e.jsxs("h2",{className:"text-base",children:["Drag and drop a CSV file here or ",e.jsx("br",{})," click button below to upload"," "]}),e.jsx("p",{children:"Upload a CSV file with the participants data. The file should contain the following columns: Entry ID, Full Name, Raffle Code, Region/Location."})]}),e.jsxs(re.Footer,{children:[w?e.jsx(Se,{className:"bg-red-800 hover:bg-red-800 animate-pulse text-white !cursor-not-allowed",children:"Reading File..."}):d?e.jsx(Se,{onClick:()=>{w||F()},children:"Select & Attach File"}):e.jsx(e.Fragment,{children:e.jsxs(Se,{className:"bg-red-800 hover:bg-red-800 animate-pulse text-white !cursor-not-allowed",children:["File is invalid. Try again in ",u," ","seconds."]})}),e.jsx("label",{htmlFor:"file-upload",className:"sr-only hidden",children:"Upload File"}),e.jsx("input",{type:"file",name:"file-upload",id:"file-upload",title:"Upload a CSV file",className:"hidden",ref:j,accept:".csv",onChange:ee})]})]})}),!x&&e.jsxs("div",{className:"text-red-400 mt-4",children:[e.jsx("h2",{className:"text-xl",children:"Server is Offline:"}),e.jsx("p",{children:"Turn on or connect to the server to double check if there is available data on the cloud"})]})]})})},cs=t=>{const s=["B","KB","MB","GB","TB"];let r=t,n=0;for(;r>=1024&&n<s.length-1;)r/=1024,n++;return`${r.toFixed(2)} ${s[n]}`},ds=({fileAttached:t,fileDetails:s,setTriggerImport:r,setUploadStatus:n,uploadStatus:o,setFileAttached:c,setFileDetails:h,cloudData:f})=>{const[x]=_("withCloudData"),d=()=>{t&&(r(!0),n("processing"))},p=()=>{r(!0),n("processing")},y=()=>{c(null),h(null),n("idle")};return e.jsx("div",{className:`upload-phase ${o!=="attached"&&"hidden"}`,children:x?e.jsxs(re,{className:"bg-emerald-800",children:[e.jsx(re.Header,{className:"text-left",children:"Data Downloaded"}),e.jsxs(re.Body,{className:"flex justify-center items-start gap-5",children:[e.jsx("div",{className:"file-icon ",children:e.jsx(me,{icon:It,className:"text-white text-[80px]"})}),e.jsxs("div",{className:"file-details flex flex-col justify-between items-start h-[80px]",children:[e.jsx("div",{className:"file-name text-lg font-bold w-[200px] overflow-hidden ",children:e.jsx("span",{className:"italic",children:"Unknown File"})}),e.jsx("div",{className:"file-subdetails text-sm flex flex-col items-start",children:e.jsxs("span",{children:["Total Entries:"," ",s?e.jsx(e.Fragment,{children:s.entries.toLocaleString()}):e.jsx("span",{className:"italic",children:"--"})]})})]})]}),e.jsxs(re.Footer,{children:[e.jsx("div",{className:"two-btns flex gap-2"}),e.jsx(Se,{className:"bg-[#0000008c]! hover:bg-[#00000052]!",onClick:p,children:"Submit & Process Data"})]})]}):e.jsxs(re,{className:"bg-emerald-800",children:[e.jsx(re.Header,{className:"text-left",children:"File Attached:"}),e.jsxs(re.Body,{className:"flex justify-center items-start gap-5 w-full",children:[e.jsx("div",{className:"file-icon ",children:e.jsx(me,{icon:bt,className:"text-white text-[80px]"})}),e.jsxs("div",{className:"file-details flex flex-col justify-between items-start h-[80px] grow w-0",children:[e.jsx("div",{className:"file-name text-lg font-bold mb-2",children:t?e.jsx("span",{className:"break-all line-clamp-2 w-full",children:t.name}):e.jsx("span",{className:"italic",children:"Unknown File"})}),e.jsxs("div",{className:"file-subdetails text-sm flex flex-col items-start",children:[e.jsxs("span",{children:["Size:"," ",e.jsx("b",{children:t?cs(t.size):e.jsx("span",{className:"italic",children:"--"})})]}),e.jsxs("span",{children:["Entries:"," ",s?e.jsx(e.Fragment,{children:s.entries.toLocaleString()}):e.jsx("span",{className:"italic",children:"--"})]})]})]})]}),e.jsxs(re.Footer,{children:[e.jsx("div",{className:"two-btns flex gap-2",children:e.jsx(Se,{className:"bg-red-700 hover:bg-red-600",onClick:y,children:"Cancel"})}),e.jsx(Se,{className:"bg-[#0000008c]! hover:bg-[#00000052]!",onClick:d,children:"Submit & Process File"})]})]})})},us=t=>{const s=["B","KB","MB","GB","TB"];let r=t,n=0;for(;r>=1024&&n<s.length-1;)r/=1024,n++;return`${r.toFixed(2)} ${s[n]}`},fs=t=>new Promise((s,r)=>{Ke.parse(t,{complete:n=>{s(n.data)},error:n=>{r(n)},header:!0,skipEmptyLines:!0})});function Ae(t){return t<10?"0"+t:""+t}async function hs(t,s,r){const c=t.sort((h,f)=>h.id_entry-f.id_entry).map(h=>{var d;let f=h.registered_at;if(typeof f=="string"||f instanceof Date){const p=new Date(f);if(!isNaN(p.getTime()))f=x(p);else throw new Error("Invalid date format for registered_at")}function x(p){return`${p.getFullYear()}-${Ae(p.getMonth()+1)}-${Ae(p.getDate())} ${Ae(p.getHours())}:${Ae(p.getMinutes())}:${Ae(p.getSeconds())}`}return{is_archived:!1,participant_batch_id:1,...h,is_drawn:h.is_drawn===0||!h.is_drawn?"false":"true",id_entry:(d=h.id_entry)==null?void 0:d.toString(),registered_at:f}});for(let h=0;h<c.length;h+=2500){const x=c.slice(h,h+2500).map(d=>Le("participant",d));try{await Promise.all(x);const d=parseFloat(((h+2500)/c.length*100).toFixed(2));r(d)}catch(d){console.error("Error adding participants in batch:",d)}}return c}async function ps(t,s,r){const n=[],o={api_url:r,source:"client-app",destination:"cloud-server",type:"sync-batch",payload:t,method_type:"POST",status:"pending",retry_count:0,error_message:null,priority:"medium",reference_id:s,content_type:"application/json",triggered_by:"system",is_test:!1,next_retry_at:null,headers:{},response_body:null,duration:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{const c=await Le("syncCloud",o);n.push(c),console.log("✅ Batch successfully queued to syncCloud:",o)}catch(c){console.error("❌ Batch insert to syncCloud failed:",c)}return n}async function ms(t,s,r,n){let o;const c=[],h=t.length;h>=5e5?o=6e4:h>=3e5?o=25e3:o=1e4,console.log("🔄 Starting sync to cloud..."),console.log(`🧾 Total entries: ${t.length}`),console.log(`📦 Batch size: ${o}`),console.log(`🆔 Batch ID: ${s}`),console.log(`🌐 API URL: ${r}`);for(let f=0;f<t.length;f+=o){const x=t.slice(f,f+o),d=Math.floor(f/o)+1;console.log(`🚚 Processing batch ${d}...`),console.log(`🔢 Entries in this batch: ${x.length}`);try{const p=await ps(x,s,r);c.push(...p);const y=parseFloat(((f+o)/t.length*100).toFixed(2));n(y),console.log(`✅ Batch ${d} added to queue.`),console.log(`📈 Progress: ${y}%`)}catch(p){console.error(`❌ Error syncing batch ${d}:`,p)}}return console.log("🎉 All batches processed and queued for sync."),c}function xs(t){if(t===0)return"0 B";const s=["B","KB","MB","GB","TB"],r=1024,n=Math.floor(Math.log(t)/Math.log(r)),o=t/Math.pow(r,n);return`${o%1===0?o:o.toFixed(2)} ${s[n]}`}const gs=({fileAttached:t,fileDetails:s,triggerImport:r,setUploadStatus:n,uploadStatus:o,cloudData:c,setUploadElapsedTime:h})=>{const[f,x]=l.useState(0),[d,p]=l.useState(!1),[y,q]=l.useState(0),[S,P]=l.useState(0),[B,m]=l.useState(!1),[A,T]=l.useState(0),[O,D]=l.useState(0),v=l.useRef(null),k=l.useRef(null),[j]=_("withCloudData"),[a,i]=_("regionalStats",{defaultValue:null});l.useEffect(()=>{S>0&&v.current===null&&(v.current=Date.now(),k.current=setInterval(()=>{if(v.current){const C=Math.floor((Date.now()-v.current)/1e3);T(C)}},1e3)),S>=100&&k.current&&(clearInterval(k.current),k.current=null)},[S]),l.useEffect(()=>{if(S>0&&S<100&&A>0){const H=A/S*100-A;D(Math.ceil(H))}S===100&&D(0),S>=100&&h(A)},[S,A]);function u(C){const se=[{label:"d",value:Math.floor(C/86400)},{label:"h",value:Math.floor(C%86400/3600)},{label:"m",value:Math.floor(C%3600/60)},{label:"s",value:C%60}].filter(ee=>ee.value>0).slice(0,2);return se.length>0?se.map(ee=>`${ee.value}${ee.label}`).join(" "):"0s"}const b=async C=>{try{let H;if(C?H=await fs(C):H=c,H){const se=await hs(H,"WEEK-2025-06",ee=>{P(ee)});if(se){const ee=await w();if(!j&&ee){const I=await ms(se,"batch-2025-05-13-A","/participants/per-batch",Y=>{})}}console.log("Import completed ✅")}}catch(H){console.error("Import failed",H)}},w=async()=>{const C=await Mt(q);return C?(i(C),!0):!1};return l.useEffect(()=>{S>=100&&y>=100&&n("completed")},[S,y]),l.useEffect(()=>{s&&(s==null?void 0:s.entries)>0&&Math.round(f/s.entries*100)},[f]),l.useEffect(()=>{r&&t&&s?s.entries>0&&b(t):r&&c&&b()},[r,s,c]),e.jsx("div",{className:`upload-phase ${o!=="processing"&&"hidden"}`,children:e.jsxs(re,{className:"bg-green-800 relative overflow-hidden",children:[e.jsx(re.Header,{className:"text-left z-10",children:c?"Processing Downloaded Data...":"Uploading File..."}),e.jsx(re.Body,{className:"flex flex-col justify-between z-10 w-full",children:e.jsxs("div",{className:"flex justify-center items-center gap-5 w-full",children:[e.jsx("div",{className:"file-icon w-[80px] mr-4",children:c?e.jsx(me,{icon:wt,className:"text-white text-[80px] "}):e.jsx(me,{icon:bt,className:"text-white text-[80px]"})}),e.jsxs("div",{className:"file-details flex flex-col justify-between items-start h-[80px] grow w-0",children:[e.jsx("div",{className:"file-name text-lg font-bold mb-2",children:t?e.jsx("span",{className:"break-all line-clamp-2 w-full",children:t.name}):c?e.jsx(e.Fragment,{children:"Data from Cloud"}):e.jsx("span",{className:"italic",children:"Unknown File"})}),e.jsxs("div",{className:"file-subdetails text-sm flex flex-col items-start",children:[e.jsxs("span",{children:["Size:"," ",e.jsx("b",{children:t&&s?us(t.size):c?e.jsx(e.Fragment,{children:xs((s==null?void 0:s.entries)*70)}):e.jsx("span",{className:"italic",children:"--"})})]}),e.jsxs("span",{children:["Entries:"," ",s?e.jsx(e.Fragment,{children:s.entries.toLocaleString()}):e.jsx("span",{className:"italic",children:"--"})]})]})]})]})}),e.jsxs(re.Footer,{className:" z-10",children:[e.jsxs("div",{className:"clock flex text-sm justify-between",children:[e.jsxs("div",{className:"time-detail bg-[#00000056] p-1 px-2.5 rounded-2xl",children:["⏱️ ELT: ",u(A)," "]}),e.jsxs("div",{className:"time-detail bg-[#00000056] p-1 px-2.5 rounded-2xl",children:["⌛ ETR: ",u(O)," "]})]}),e.jsx(Se,{clickable:!1,className:"bg-[#0000008c]! ",children:B?e.jsx("span",{className:"pulse text-red-600 font-bold",children:"Please wait..."}):e.jsx(e.Fragment,{children:S<100?e.jsxs(e.Fragment,{children:["Processing File - ",S.toFixed(2),"%"]}):e.jsxs(e.Fragment,{children:["Getting Regional Stats - ",y.toFixed(2),"%"]})})})]}),e.jsx("div",{className:"progress-bar absolute top-0 left-0 h-full bg-green-600 -z-0  transition-all ease-linear  animate-pulse ",style:{width:`${S}%`}}),e.jsx("div",{className:"progress-bar absolute top-0 left-0 h-full bg-amber-600 -z-0  transition-all ease-linear  animate-pulse opacity-40 ",style:{width:`${y}%`}})]})})},bs=({selectedWeek:t,uploadStatus:s,uploadElapsedTime:r,cloudData:n,downloadElapsedTime:o})=>{const[c,h]=_("withParticipantsData"),[f,x]=_("fileDetails",{defaultValue:null}),d=()=>{h(!0)};function p(y){const S=[{label:"d",value:Math.floor(y/86400)},{label:"h",value:Math.floor(y%86400/3600)},{label:"m",value:Math.floor(y%3600/60)},{label:"s",value:y%60}].filter(P=>P.value>0).slice(0,2);return S.length>0?S.map(P=>`${P.value}${P.label}`).join(" "):"0s"}return e.jsx("div",{className:`upload-phase ${s!=="completed"&&"hidden"}`,children:e.jsxs(re,{className:"bg-yellow-800 relative overflow-hidden",children:[e.jsx(re.Header,{children:"Processing Complete!"}),e.jsxs(re.Body,{className:"flex flex-col justify-around z-10",children:[e.jsx("div",{className:"time-remaining",children:e.jsxs("div",{className:"bg-[#000000d8] text-white flex flex-col justify-center items-center rounded-full p-3 px-6",children:["Selected Week: ",e.jsx("br",{}),e.jsx("span",{className:"font-bol",children:t?t.weekName:"Loading"})]})}),e.jsx("div",{className:"flex justify-center items-center",children:e.jsx("div",{className:"file-details flex flex-col justify-between items-start",children:e.jsxs("div",{className:"file-subdetails text-sm flex flex-col items-center",children:[e.jsx("span",{children:"Total Entries"}),e.jsx("span",{className:"font-bold",children:f==null?void 0:f.entries.toLocaleString()})]})})})]}),e.jsxs(re.Footer,{className:" z-10",children:[e.jsxs("div",{className:"elapsed-time",children:[n?"Download Process Time:":"Upload Process Time:"," ",e.jsx("span",{className:"font-bold",children:n?e.jsxs(e.Fragment,{children:[" ",p(r+o)]}):e.jsxs(e.Fragment,{children:[" ",p(r)]})})]}),e.jsx(Se,{className:"bg-[#0000008c]! hover:bg-[#00000052]! ",onClick:d,children:"Confirm Done"})]})]})})},ws=({uploadComplete:t})=>{const[s,r]=l.useState(null),[n,o]=_("fileDetails",{defaultValue:null}),[c,h]=l.useState(null),[f,x]=l.useState(!1),[d,p]=l.useState(0),[y,q]=l.useState(0),[S,P]=l.useState("idle"),[B]=_("withCloudData"),[m,A]=_("selectedWeek",{defaultValue:null}),T=()=>{s&&console.log(s.name)};return l.useEffect(()=>{s&&T()},[s]),e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex flex-col gap-2 text-sm w-full",children:e.jsxs("div",{className:"upload-data w-full",children:[e.jsxs("div",{className:"bg-gray-950 text-white h-[40px] flex justify-center items-center rounded-full  mb-2",children:["Selected Week: ",m?m.weekName:"Loading"]}),!B&&e.jsx("p",{className:"text-gray-300 text-sm mb-2 text-center italic",children:"No participants data found."}),e.jsx(os,{setFileAttached:r,setFileDetails:o,setUploadStatus:P,uploadStatus:S,setCloudData:h,setTriggerImport:x,setDownloadElapsedTime:q,fileAttached:s}),e.jsx(ds,{fileAttached:s,fileDetails:n,setTriggerImport:x,setUploadStatus:P,uploadStatus:S,setFileAttached:r,setFileDetails:o,cloudData:c}),e.jsx(gs,{fileAttached:s,fileDetails:n,triggerImport:f,setUploadStatus:P,uploadStatus:S,cloudData:c,setUploadElapsedTime:p}),e.jsx(bs,{selectedWeek:m,uploadStatus:S,uploadElapsedTime:d,cloudData:c,downloadElapsedTime:y})]})})})},ys=()=>{const[t,s]=_("regionalStats",{defaultValue:null});return e.jsx(e.Fragment,{children:e.jsxs("div",{children:[e.jsx("div",{className:"title text-xl font-bold text-red-300",children:"Overall Summaries"}),e.jsxs("div",{className:"flex flex-col mt-2",children:[e.jsx("div",{className:"location text-base",children:"TOTAL PARTICIPANTS:"}),e.jsx("div",{className:"regional-count text-2xl font-bold",children:t==null?void 0:t.totalParticipants.toLocaleString()})]}),e.jsxs("div",{className:"flex flex-col mt-2",children:[e.jsx("div",{className:"location text-base",children:"DAILY AVERAGE:"}),e.jsx("div",{className:"regional-count text-2xl font-bold",children:t==null?void 0:t.dailyAverage.toLocaleString()})]}),e.jsx("div",{className:"title text-xl mt-5 font-bold text-red-300",children:"Regional Statistics"}),t==null?void 0:t.regions.map(r=>e.jsxs("div",{className:"flex flex-col mt-2",children:[e.jsx("div",{className:"location text-base",children:r.location}),e.jsx("div",{className:"regional-count text-2xl font-bold",children:r.count.toLocaleString()})]},r.location))]})})},Ve=({isActive:t=!1,children:s,className:r})=>e.jsx("div",{className:`w-full flex-col justify-between relative   text-white grow ${t?"flex":"hidden"} ${r}`,children:s}),Ce=({position:t,children:s,className:r})=>e.jsx(e.Fragment,{children:t==="top"?e.jsx("div",{className:`top-part flex flex-col grow overflow-hidden ${r}`,children:e.jsx("div",{className:"flex bg-gradient-to-b from-gray-900 to-gray-800 h-0 grow overflow-y-scroll w-full flex-col  p-4 ",children:s})}):e.jsx("div",{className:"bottom-part flex justify-between items-center text-sm",children:e.jsx("div",{className:"flex bg-gray-800 w-full justify-between items-center  p-4 ",children:s})})}),je=({title:t,children:s,className:r})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:`sub-panel mb-3 ${r}`,children:[e.jsx("h2",{className:"mb-2",children:t}),s]})}),Ie=({children:t,onClick:s,className:r=""})=>e.jsx("button",{className:`bg-gray-600 hover:bg-gray-500 px-4 h-[40px] rounded-2xl cursor-pointer ${r}`,onClick:s,children:t});async function vs(t){return await zt("participant",2e3,t)}const js=({openModal:t})=>{const[s,r]=_("withParticipantsData",{defaultValue:!1}),n=()=>{t(!0)};return e.jsx(e.Fragment,{children:e.jsx(Ie,{onClick:n,children:"Clear All Participants"})})};function Ns(t){const r=[{label:"d",value:Math.floor(t/86400)},{label:"h",value:Math.floor(t%86400/3600)},{label:"m",value:Math.floor(t%3600/60)},{label:"s",value:t%60}].filter(n=>n.value>0).slice(0,2);return r.length>0?r.map(n=>`${n.value}${n.label}`).join(" "):"0s"}const Ss=({setIsPresenting:t,isPresenting:s,isActiveTab:r})=>{const[n,o]=_("withParticipantsData"),[c,h]=_("regionalStats"),[f,x]=_("fileDetails",{defaultValue:null}),d=l.useRef(null),[p,y]=l.useState(!1),[q,S]=l.useState(!1),[P,B]=l.useState(!1),[m,A]=l.useState(""),[T,O]=l.useState(""),[D,v]=l.useState(!1);l.useEffect(()=>{var M;return P&&((M=d.current)==null||M.focus()),()=>{}},[P]),l.useEffect(()=>{v(m==="delete-all-participants")},[m]);const[k,j]=l.useState(!1),a=l.useRef(Date.now()),[i,u]=l.useState(0),[b,w]=l.useState(60),C=(M,oe)=>{const ue=M/oe*100;u(ue);const L=Date.now()-a.current;if(M===0){w(60);return}const F=L/(M/oe)-L,J=Math.ceil(Math.max(0,F/1e3));w(J)},H=()=>{B(!1),T==="all"?te():E()},se=M=>{O(M),B(!0)},ee=()=>{B(!1),O("")},I=()=>{y(!1)},Y=()=>{S(!0)},R=()=>{S(!1)},te=()=>{V(),ne(),I()},E=()=>{ne(),I()},V=async()=>{alert("Attempt to clear participants in backend. Still not working. Will make it work later. This is temporary prompt. Enhancement ongoing.")},N=M=>{A(M.target.value)},ne=async()=>{j(!0),await vs(C)&&(j(!1),o(!1),h(null),x(null))};return l.useEffect(()=>{i>=100&&(j(!1),o(!1),h(null),x(null))},[i]),e.jsxs(Ve,{isActive:r,children:[e.jsx(Ce,{position:"top",children:e.jsx(je,{title:`${n?"Participants Overview":"Upload Data"}`,children:n?e.jsx(ys,{}):e.jsx(ws,{uploadComplete:o})})}),e.jsx(Ce,{position:"bottom",children:n?e.jsx(js,{openModal:y}):""}),e.jsx("div",{className:`checkpoint bg-[#220404b6] w-full h-full absolute left-0 top-0 text-black flex justify-center items-center ${!p&&"hidden"}`,children:e.jsx("div",{className:"checkpoint-content bg-white rounded-2xl p-4 text-center w-8/10",children:q?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-red-600 font-bold",children:"Clear All Participants Data:"}),e.jsx("div",{className:"text-sm mt-4",children:"Do you want to clear participants in the database too?"}),e.jsxs("div",{className:"choices mt-6 flex gap-3 justify-between w-full flex-col",children:[e.jsx("button",{className:"bg-red-400 hover:bg-red-500 p-2 px-3 rounded-xl cursor-pointer text-sm",onClick:()=>{se("app-only")},children:"No, only here on app."}),e.jsx("button",{className:"text-white bg-red-700 hover:bg-red-900 p-2 px-3 rounded-xl cursor-pointer text-sm",onClick:()=>{se("all")},children:"Yes, on database too."}),e.jsx("button",{className:"bg-gray-400 hover:bg-gray-500 p-2 px-3 rounded-xl cursor-pointer text-sm",onClick:R,children:"Go Back"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"text-red-600 font-bold",children:"Clear All Participants Data:"}),e.jsx("div",{className:"text-sm mt-4",children:"Are you sure you want to delete all participants in this batch?"}),e.jsxs("div",{className:"choices mt-6 flex gap-4 justify-between",children:[e.jsx("button",{className:"bg-gray-400 hover:bg-gray-500 p-2 px-3 rounded-xl cursor-pointer text-sm",onClick:I,children:"Cancel"}),e.jsx("button",{className:"bg-red-400 hover:bg-red-500 p-2 px-3 rounded-xl cursor-pointer text-sm",onClick:Y,children:"Yes, delete."})]})]})})}),e.jsx("div",{className:`checkpoint bg-[#220404b6] w-full h-full absolute left-0 top-0 text-black flex justify-center items-center ${!k&&"hidden"}`,children:e.jsxs("div",{className:"checkpoint-content bg-white rounded-2xl p-4 text-center w-8/10",children:[e.jsx("div",{className:"text-red-600 font-bold",children:"Clearing Participants..."}),e.jsxs("div",{className:"text-sm mt-4",children:["Progress: ",i.toFixed(2),"%"]}),e.jsxs("div",{className:"text-sm mt-4",children:["Time Remaining: ",Ns(b)]})]})}),e.jsx("div",{className:`checkpoint bg-[#220404b6] w-full h-full absolute left-0 top-0 text-black flex justify-center items-center ${!P&&"hidden"}`,children:e.jsxs("div",{className:"checkpoint-content bg-white rounded-2xl p-4 text-center w-8/10",children:[e.jsx("div",{className:"text-red-600 font-bold",children:"Enter Confirmation"}),e.jsxs("div",{className:"text-sm mt-4",children:["You are about to delete"," ",T==="all"?" all participants including saved in database. ":" only here saved in this app."]}),e.jsx("div",{className:"text-sm mt-2",children:'Please enter "delete-all-participants" all in lower case to confirm clearing of participants.'}),e.jsxs("div",{className:"input-container flex flex-col",children:[e.jsx("input",{type:"text",name:"clearing-passkey",autoComplete:"off","aria-label":"clearing-passkey",ref:d,className:`mt-3 h-[30px] px-4 rounded-2xl text-center text-sm  ${D?"bg-amber-200 text-red-800":"bg-gray-600 text-white"}`,id:"",onChange:M=>{N(M)}}),e.jsx("span",{className:`italic text-xs mt-1 ${D?"text-green-600 font-bold":"text-gray-500"}`,children:D?"Passkey matched":"Passkey do not match"})]}),e.jsxs("div",{className:"choices mt-6 flex gap-4 justify-between",children:[e.jsx("button",{className:"bg-gray-400 hover:bg-gray-500 p-2 px-3 rounded-xl cursor-pointer text-sm",onClick:ee,children:"Cancel"}),e.jsx("button",{className:` p-2 px-3 rounded-xl  text-sm ${D?"bg-red-400 hover:bg-red-500 cursor-pointer":"bg-gray-500 text-gray-700 cursor-not-allowed"}`,onClick:()=>{D&&H()},children:"Delete"})]})]})})]})};async function ks(t){const s={api_url:"/winner-participants",source:"client-app",destination:"cloud-server",type:"sync-winner",payload:t,method_type:"POST",status:"pending",retry_count:0,error_message:null,priority:"medium",reference_id:null,content_type:"application/json",triggered_by:"system",is_test:!1,next_retry_at:null,headers:{},response_body:null,duration:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{return await Le("syncCloud",s),console.log("🏆 Winner participant synced to queue:",s),!0}catch(r){return console.error("❌ Failed to queue winner participant:",r),!1}}const _s={winner_status:!1};async function kt(t,s){const r=await Ne();try{const n=r.transaction("winnerParticipant","readwrite").objectStore("winnerParticipant"),{is_drawn:o,...c}=t,h={is_drawn:!0,draw_date:new Date().toISOString(),..._s,...c,winner_type:s};return await n.add(h),await ks(h)&&console.log("Winner participant added to cloud sync queue..."),console.log(`Winner participant added: ${t.full_name} with type ${s}`),!0}catch(n){return console.error("Error adding winner participant:",n),!1}}async function Cs(t){const s=await Ne();try{const r=s.transaction("participant","readwrite"),n=r.objectStore("participant"),c=await n.index("raffle_code").get(t);if(c)c.is_drawn="true",await n.put(c),console.log(`Participant with raffle_code ${t} marked as drawn.`);else return console.warn(`No participant found with raffle_code ${t}`),!1;return await r.done,!0}catch(r){return console.error("Error updating winner participant:",r),!1}}const Ps=({isActiveTab:t})=>{var De,Ge,Ye,Je,Xe,Ze,et,tt,st,nt,at,rt,it,lt,ot,ct;const[s,r]=_("favoredRegion",{defaultValue:void 0}),{winnerRecords:n,setWinner:o,setBackupWinner:c,resetWinners:h,getFilledWinners:f}=Bt(),[x,d]=_("fileDetails"),[p,y]=_("startDraw",{defaultValue:!1}),[q,S]=_("withParticipantsData"),[P,B]=l.useState(!1),[m,A]=l.useState(!0),[T,O]=l.useState(!1),[D]=_("presentingStatus"),[v]=_("presentingView");l.useEffect(()=>{console.log("Generating winner start...")},[P]);const[k,j]=l.useState(!1),[a,i]=l.useState(!1),[u,b]=l.useState(!1),[w,C]=l.useState(!1),[H,se]=l.useState(!0),[ee,I]=l.useState(!0),[Y,R]=l.useState(!0),te=(le,he)=>{const pe=he==="on";switch(le){case 1:i(pe);break;case 2:b(pe);break;case 3:C(pe);break;default:j(pe);break}},E=async(le="primary",he=0)=>{if(console.log("Attempting: ",le," ",he),Q(!1),N("idle"),M(!1),le==="primary")te(0,"on"),G(s?`Picking Primary Winner from ${s}...`:"Picking Primary Winner...");else{te(he+1,"on");const Re=he===0?"1st":he===1?"2nd":"3rd";G(s?`Picking ${Re} Backup Winner from ${s}...`:`Picking ${Re} Backup Winner...`)}const pe=await ve(le,s);pe?(le==="primary"?(o(pe),console.log("Setting Winner"),Z(1)):(console.log("Setting Backup Winner"),(he===0||he===1||he===2)&&(c(he,pe),Z(he+2))),y(!0)):console.warn("Winner generation failed, draw not started")},[V,N]=_("slotCodeStatus",{defaultValue:"idle"}),[ne,M]=_("revealWinner",{defaultValue:!1}),[oe,ue]=_("refreshTable",{defaultValue:0}),[z,L]=_("showWinnerNth",{defaultValue:0}),[ae,F]=_("winners"),[J,ie]=l.useState(!1),[K,Q]=_("isRevealed"),[U,$]=_("revealWinner01",{defaultValue:!1}),[g,W]=_("revealWinner02",{defaultValue:!1}),[xe,we]=_("revealWinner03",{defaultValue:!1}),[be,ge]=_("revealWinner04",{defaultValue:!1}),[ce,de]=_("slotCode",{defaultValue:"??????????"}),[X,G]=l.useState("Not Started Yet"),ye=le=>{const he=setTimeout(()=>{L(le-1),N("roll"),clearInterval(he)},1e3),pe=setTimeout(()=>{switch(le){case 1:$(!0),te(0,"off"),G(s?`Primary Winner Picked from ${s}`:"Primary Winner Picked"),se(!1);break;case 2:W(!0),te(1,"off"),G(s?`1st Backup Winner Picked from ${s}`:"1st Backup Winner Picked"),I(!1);break;case 3:we(!0),te(2,"off"),G(s?`2nd Backup Winner Picked from ${s}`:"2nd Backup Winner Picked"),R(!1);break;case 4:ge(!0),te(3,"off"),G(s?`3rd Backup Winner Picked from ${s}`:"3rd Backup Winner Picked");break}M(!0),ue(Re=>Re+1),clearInterval(pe)},3e3)},Z=le=>{ye(le)},fe=()=>{const le=X;G("Resetting Machine..."),N("idle"),M(!1),Q(!1);const he=setTimeout(()=>{G(le),clearTimeout(he)},1e3)},ke=async(le,he)=>{try{return await kt(le,he)?await Cs(le.raffle_code)?(console.log("Success saving winner: ",le.full_name," with winner type of ",he),!0):(console.error("Failed to update winner:",le.full_name),!1):(console.error("Failed to save winner:",le.full_name),!1)}catch(pe){return console.error("Error saving winner:",le.full_name,pe),!1}},ve=async(le="primary",he)=>{console.log("Picking Random Participant");try{const pe=await jt(he??void 0);return pe&&(ke(pe,le),console.log(pe),A(!0)),pe}catch(pe){return A(!1),fe(),O(!0),console.error("Error picking random participant:",pe),null}},_e=()=>{ie(!0),fe(),G("Clearing Winners...");const le=setTimeout(()=>{ie(!1),F(null),h(),$(!1),W(!1),we(!1),ge(!1),se(!0),I(!0),R(!0),clearTimeout(le)},1e3)};return l.useEffect(()=>{if(D!=="presenting"&&v!=="raffle-draw"){G("Not Started Yet");return}J||G(s?`Picking from ${s}`:"Picking from All Philippines")},[D,v,s,J]),e.jsx(e.Fragment,{children:e.jsxs(Ve,{isActive:t,className:"",children:[e.jsxs(Ce,{position:"top",className:"relative !px-0 !m-0 !bg-orange-200",children:[e.jsx(je,{title:"Raffle Draw Status",className:"sticky top-0 bg-linear-to-b from-gray-900 via-[#101828a6] to-[#00000000] py-4 pb-11 !mb-0",children:e.jsx("div",{className:"raffle-draw-status bg-[#030712e8] w-full rounded-xl h-[80px] border-gray-600 border-2 flex items-center justify-center text-lg font-[courier] font-bold text-amber-200 text-shadow-amber-800 text-shadow-sm line-clamp-2 px-4 -mb-4",children:e.jsx("span",{className:"animate-pulse text-center break-words",children:X})})}),e.jsx(je,{title:"Winner",className:"gap-3 flex flex-col",children:e.jsx("div",{className:"grid w-full",children:e.jsx("div",{className:"participant-card text-sm w-full bg-gray-700 p-3 rounded-xl ",children:k?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"h-[50px] w-full text-center flex justify-center items-center",children:["Loading... Please wait."," "]})}):e.jsx(e.Fragment,{children:f().primary&&U?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"participant-name text-xl",title:(De=n.primary)==null?void 0:De.full_name_raw,children:(Ge=n.primary)==null?void 0:Ge.full_name}),e.jsxs("div",{className:"participant-details flex w-full justify-between",children:[e.jsx("div",{className:"participant-location",children:(Ye=n.primary)==null?void 0:Ye.regional_location}),e.jsx("div",{className:"participant-code font-[courier] font-bold tracking-widest",children:(Je=n.primary)==null?void 0:Je.raffle_code})]})]}):e.jsx("button",{className:"cursor-pointer hover:bg-amber-300 rounded-2xl text-black w-full p-3 bg-amber-400",onClick:()=>{E()},children:"Start Draw"})})})})}),f().backups&&f().backups.length>0&&e.jsxs(je,{title:"Backup Winners",className:"gap-3 flex flex-col",children:[e.jsx("div",{className:"grid w-full gap-3",children:e.jsx("div",{className:"participant-card text-sm w-full bg-gray-700 p-3 rounded-xl relative overflow-hidden",children:a?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"h-[50px] w-full text-center flex justify-center items-center",children:["Loading... Please wait."," "]})}):e.jsx(e.Fragment,{children:g?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"participant-name text-xl",title:(Xe=n.backups[0])==null?void 0:Xe.full_name_raw,children:(Ze=n.backups[0])==null?void 0:Ze.full_name}),e.jsxs("div",{className:"participant-details flex w-full justify-between",children:[e.jsx("div",{className:"participant-location",children:(et=n.backups[0])==null?void 0:et.regional_location}),e.jsx("div",{className:"participant-code font-[courier] font-bold tracking-widest",children:(tt=n.backups[0])==null?void 0:tt.raffle_code})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cursor-pointer hover:bg-amber-300 rounded-2xl text-black w-full p-3 bg-amber-400",onClick:()=>{console.log("Raffling backup winner #1"),E("backup",0)},children:"Raffle First Backup Winner"}),H&&e.jsxs("div",{className:"button-locker bg-[#6e0c0cce] absolute top-0 w-full h-full left-0 flex justify-center items-center gap-2",children:[e.jsx(me,{icon:qe,className:"text-lg"}),e.jsx("span",{className:"font-bold",children:"Unlock with Previous Button"})]})]})})})}),e.jsx("div",{className:"grid w-full gap-3",children:e.jsx("div",{className:"participant-card text-sm w-full bg-gray-700 p-3 rounded-xl relative",children:u?e.jsxs("div",{className:"h-[50px] w-full text-center flex justify-center items-center",children:["Loading... Please wait."," "]}):e.jsx(e.Fragment,{children:xe?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"participant-name text-xl",title:(st=n.backups[1])==null?void 0:st.full_name_raw,children:(nt=n.backups[1])==null?void 0:nt.full_name}),e.jsxs("div",{className:"participant-details flex w-full justify-between",children:[e.jsx("div",{className:"participant-location",children:(at=n.backups[1])==null?void 0:at.regional_location}),e.jsx("div",{className:"participant-code font-[courier] font-bold tracking-widest",children:(rt=n.backups[1])==null?void 0:rt.raffle_code})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cursor-pointer hover:bg-amber-300 rounded-2xl text-black w-full p-3 bg-amber-400",onClick:()=>{console.log("Raffling backup winner #2"),E("backup",1)},children:"Raffle Second Backup Winner"}),ee&&e.jsxs("div",{className:"button-locker bg-[#6e0c0cce] absolute top-0 w-full h-full left-0 flex justify-center items-center gap-2",children:[e.jsx(me,{icon:qe,className:"text-lg"}),e.jsx("span",{className:"font-bold",children:"Unlock with Previous Button"})]})]})})})}),e.jsx("div",{className:"grid w-full gap-3",children:e.jsx("div",{className:"participant-card text-sm w-full bg-gray-700 p-3 rounded-xl relative",children:w?e.jsx(e.Fragment,{children:e.jsxs("div",{className:"h-[50px] w-full text-center flex justify-center items-center",children:["Loading... Please wait."," "]})}):e.jsx(e.Fragment,{children:be?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"participant-name text-xl",title:(it=n.backups[2])==null?void 0:it.full_name_raw,children:(lt=n.backups[2])==null?void 0:lt.full_name}),e.jsxs("div",{className:"participant-details flex w-full justify-between",children:[e.jsx("div",{className:"participant-location",children:(ot=n.backups[2])==null?void 0:ot.regional_location}),e.jsx("div",{className:"participant-code font-[courier] font-bold tracking-widest",children:(ct=n.backups[2])==null?void 0:ct.raffle_code})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"cursor-pointer hover:bg-amber-300 rounded-2xl text-black w-full p-3 bg-amber-400",onClick:()=>{console.log("Raffling backup winner #3"),E("backup",2)},children:"Raffle Third Backup Winner"}),Y&&e.jsxs("div",{className:"button-locker bg-[#6e0c0cce] absolute top-0 w-full h-full left-0 flex justify-center items-center gap-2",children:[e.jsx(me,{icon:qe,className:"text-lg"}),e.jsx("span",{className:"font-bold",children:"Unlock with Previous Button"})]})]})})})})]}),e.jsx(je,{title:"Proclaimed Winner"}),e.jsx("div",{className:`checkpoint bg-[#220404b6] w-full h-full absolute left-0 top-0 text-white flex justify-center items-center ${!T&&"hidden"}`,children:e.jsxs("div",{className:"checkpoint-content bg-red-900 rounded-2xl p-4 text-center w-8/10",children:[e.jsx("div",{children:"No Participant Available"}),s!==void 0?e.jsxs("div",{className:"text-sm mt-4",children:["No winners can be raffled anymore in the specified region.",e.jsx("br",{}),"[",s,"]",e.jsx("br",{})," Please retry with different region.",e.jsx("div",{className:"button-container mt-4",children:e.jsx("button",{onClick:()=>{O(!1)},className:"bg-black hover:bg-red-950 text-white p-3 cursor-pointer rounded-2xl w-full",children:"Okay"})})]}):e.jsxs("div",{className:"text-sm mt-4",children:["No more available participants to draw. ",e.jsx("br",{}),"Please add more participants",e.jsx("div",{className:"button-container mt-4",children:e.jsx("button",{onClick:()=>{O(!1)},className:"bg-black hover:bg-red-950 text-white p-3 cursor-pointer rounded-2xl w-full",children:"Okay"})})]})]})})]}),e.jsxs(Ce,{position:"bottom",children:[e.jsx(Ie,{onClick:fe,children:"Reset Machine"}),e.jsx(Ie,{onClick:_e,children:"Clear Winners"})]}),e.jsx("div",{className:`checkpoint bg-[#220404b6] w-full h-full absolute left-0 top-0 text-white flex justify-center items-center ${D==="presenting"&&v==="raffle-draw"&&q&&"hidden"}`,children:e.jsxs("div",{className:"checkpoint-content bg-red-900 rounded-2xl p-4 text-center w-8/10",children:[e.jsx("div",{children:"Raffle Controls Disabled"}),e.jsx("div",{className:"text-sm mt-4",children:D!=="presenting"?e.jsx(e.Fragment,{children:"Please start presentation and switch to raffle view"}):v!=="raffle-draw"?e.jsx(e.Fragment,{children:"Please switch view to raffle draw."}):e.jsxs(e.Fragment,{children:["No Data available for raffle. ",e.jsx("br",{})," Please upload data first."," "]})})]})})]})})},$e=({children:t,onClick:s,className:r="",thumbnailUrl:n=""})=>e.jsx("div",{className:`view-option rounded-md aspect-video flex justify-center items-end text-sm bg-cover bg-center transition-all duration-500 ${r}`,style:{backgroundImage:n?`url(${n})`:void 0},onClick:s,children:e.jsx("div",{className:"label",children:t})}),ft="/assets/ScreenSaverThumbnail-feZ2nyR4.png",He="/assets/IntroOnlyThumnail-DWOHjF7t.png",ht="/assets/ParticipantsOverviewThumbnail-CiBylO9R.png",pt="/assets/RaffleDrawThumbnail-cguxEmwu.png",Ds=({isActiveTab:t})=>{const[s,r]=_("presentingView",{defaultValue:"intro"}),[n,o]=_("lockViewCards",{defaultValue:!1}),[c,h]=_("transitionActive",{defaultValue:!1}),f=()=>{h(!0)},x=B=>{if(s!==B){f();const m=setTimeout(()=>{r(B),clearTimeout(m)},3e3)}},[d,p]=l.useState(He),y=()=>{x("intro"),p(He)},q=()=>{x("overview"),p(ht)},S=()=>{x("raffle-draw"),p(pt)},P=()=>{x("screen-saver"),p(ft)};return e.jsx(e.Fragment,{children:e.jsxs(Ve,{isActive:t,children:[e.jsxs(Ce,{position:"top",children:[e.jsx(je,{title:"Presentation Preview",children:e.jsx("div",{className:"view-options flex  gap-2 justify-center w-full",children:e.jsx("div",{className:"view-preview  rounded-md aspect-video flex justify-center items-end text-sm  w-[80%] bg-cover bg-center transition-all duration-500",style:{backgroundImage:`url(${d})`},children:e.jsx("div",{className:"label",children:"Raffle Winner"})})})}),e.jsx(je,{title:"Choose Views",children:e.jsxs("div",{className:"view-options grid grid-cols-2 gap-2 relative",children:[e.jsx($e,{onClick:y,thumbnailUrl:He,children:"Intro Only"}),e.jsx($e,{onClick:P,thumbnailUrl:ft,children:"Screen Saver"}),e.jsxs($e,{onClick:q,thumbnailUrl:ht,children:["Participants ",e.jsx("br",{})," Overview"]}),e.jsx($e,{onClick:S,thumbnailUrl:pt,children:"Raffle Draw"}),e.jsx("div",{className:`loading-wall absolute top-0 left-0 bg-[#000000be] h-full w-full flex justify-center items-center text-white rounded-lg transition-all duration-500 ${n?"z-30 opacity-100":"-z-10 opacity-0"}`,children:"Loading View... Please wait.."})]})})]}),e.jsx(Ce,{position:"bottom",children:e.jsx(Ie,{children:"Pause Presentation"})})]})})};async function mt(t,s="data.csv",r=[]){if(t.length===0)return console.warn("No entries to export."),!1;const n=Object.keys(t[0]).filter(x=>!r.includes(x)),o=Ke.unparse({fields:n,data:t.map(x=>n.map(d=>x[d]??""))}),c=new Blob([o],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(c),f=document.createElement("a");return f.href=h,f.setAttribute("download",s),document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(h),!0}const Rs=()=>{const[t,s]=l.useState(!1),[r,n]=l.useState("Primary Winners"),[o,c]=l.useState(!1),[h,f]=l.useState("Backup Winners"),[x,d]=_("winnersDataAvailable",{defaultValue:!1}),[p]=_("refreshTable"),[y,q]=l.useState(!1),[S,P]=l.useState(!1),B=async()=>{if(!y)return;s(!0),n("Processing CSV Data");const T=await Oe("primary"),O=["is_drawn","winner_status","is_archived","participant_batch_id"],v=`KBRDS_Primary_Winners_${new Date(Date.now()+8*60*60*1e3).toISOString().replace(/[-:]/g,"_").replace("T","__").split(".")[0]}.csv`;T&&await mt(T,v,O)&&(s(!1),n("Primary Winners"))},m=async()=>{if(!S)return;c(!0),f("Processing CSV Data");const T=await Oe("backup"),O=["is_drawn","winner_status","is_archived","participant_batch_id"],v=`KBRDS_Backup_Winners_${new Date(Date.now()+8*60*60*1e3).toISOString().replace(/[-:]/g,"_").replace("T","__").split(".")[0]}.csv`;T&&await mt(T,v,O)&&(c(!1),f("Backup Winners"))},A=async()=>{const T=await Be("primary"),O=await Be("backup");!T&&!O?d(!1):(T&&q(!0),O&&P(!0),d(!0))};return l.useEffect(()=>{A()},[p]),l.useEffect(()=>{A()},[]),e.jsxs(je,{title:"Export Winner Data",className:"pt-4 border-t-2 border-solid border-gray-300 mt-4",children:[e.jsx("p",{className:"text-sm",children:"Choose winner type to download:"}),x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[e.jsx("div",{className:`button-1  p-3 text-center rounded-2xl aspect-video flex justify-center items-center px-5   ${y?t?"disabled bg-red-800 cursor-not-allowed":"bg-emerald-800 hover:bg-emerald-700 cursor-pointer":"bg-gray-500 text-black cursor-not-allowed"}`,onClick:B,children:e.jsx("div",{className:"text-base",children:y?r:"No Data for Primary Winners"})}),e.jsx("div",{className:`button-1  p-3 text-center rounded-2xl aspect-video flex justify-center items-center px-5   ${S?o?"disabled bg-red-800 cursor-not-allowed":"bg-emerald-800 hover:bg-emerald-700 cursor-pointer":"bg-gray-500 text-black cursor-not-allowed"}`,onClick:m,children:e.jsx("div",{className:"text-base",children:S?h:"No Data for Backup Winners"})})]}),e.jsx("p",{className:"text-sm italic mt-3",children:"Data are updated in real time."})]}):e.jsxs("div",{className:"mt-6 text-red-400",children:["No data available for winners. ",e.jsx("br",{}),"Start raffle to have winners."]})]})},Es=({isActiveTab:t})=>{const[s,r]=l.useState(null),[n]=_("regionalStats"),[o,c]=_("favoredRegion",{defaultValue:void 0}),h=async(d,p)=>{await kt(d,p)&&console.log("Success saving winner: ",d.full_name," with winner type of ",p)},f=(d,p)=>{const y=d.target.value;p(y==="undefined"?void 0:y)},x=async(d="primary",p)=>{console.log("Picking Random Participant");const y=await jt(p??void 0);y&&(r(y),h(y,d),console.log(y))};return e.jsx(Ve,{isActive:t,children:e.jsxs(Ce,{position:"top",children:[e.jsxs(je,{title:"Regional Picking Parameter",children:[e.jsx("p",{className:"text-sm",children:"Choose Region to choose winner from"}),n&&(n==null?void 0:n.regions.length)>0?e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"region-select",className:"block text-sm font-medium",children:"Select Region"}),e.jsxs("select",{name:"region-select",id:"region-select",className:"w-full bg-gray-600 p-2 mt-2 rounded-2xl",value:o??"undefined",onChange:d=>f(d,c),children:[e.jsx("option",{value:"undefined",children:"National (Whole Philippines)"}),n==null?void 0:n.regions.map((d,p)=>e.jsx("option",{value:d.location,className:"capitalize first-letter:uppercase",children:d.location},p))]}),e.jsx("p",{className:"text-sm mt-1 italic mb-4",children:"Resets to 'all regions' every restart of application."}),e.jsxs("div",{className:"mt-5 p-3 rounded-2xl bg-blue-800 text-white",children:[e.jsx("div",{className:"text-sm",children:"Confirmed Favored Location: "}),e.jsx("div",{className:"text-lg",children:o??"National (Whole Philippines)"})]})]}):e.jsx("div",{className:"mt-6 text-red-400",children:"No data available for regional stats"})]}),e.jsx(Rs,{}),e.jsx(je,{title:"Testing Buttons",className:"hidden",children:e.jsxs("div",{className:"button-bar flex justify-end",children:[e.jsx(Ie,{className:"self-end ml-auto text-sm px-2",onClick:x,children:"Pick Random Participant"}),e.jsx("p",{children:"Random Participant Picked: "})]})})]})})},Ts=({controlPanelOpen:t,setIsPresenting:s,isPresenting:r})=>{const[n,o]=l.useState("overview"),[c,h]=l.useState(!1);return e.jsxs("aside",{className:`side-panel bg-gray-800 w-[400px]  flex-col text-white relative ${t?"flex":"hidden"}`,children:[e.jsx(Zt,{isPresenting:r,setIsPresenting:s}),e.jsx(es,{setActiveTab:o,activeTab:n}),e.jsx(Ss,{setIsPresenting:s,isPresenting:r,isActiveTab:n==="overview"}),e.jsx(Ps,{isActiveTab:n==="raffle"}),e.jsx(Ds,{isActiveTab:n==="presentation"}),e.jsx(Es,{isActiveTab:n==="configure"})]})},Fs=()=>{const[t,s]=l.useState(!1),r=()=>{s(n=>!n)};return e.jsx(e.Fragment,{children:e.jsxs("div",{className:"pagination-settings h-full relative flex items-center justify-center",children:[e.jsx("button",{type:"button",className:"pagination-settings-button text-base cursor-pointer flex items-center justify-center w-[30px] h-[30px] rounded-full bg-orange-200 hover:bg-orange-300 active:bg-orange-400 transition-all duration-200 ease-in-out","aria-label":"Pagination Settings",onClick:r,children:e.jsx(me,{icon:Wt,className:"text-gray-600"})}),e.jsxs("div",{className:`bg-orange-800 text-white h-[80px] w-[150px] items-center justify-center px-2  absolute top-0 left-1/2 z-40 -translate-y-[calc(100%_-_10px)] -translate-x-1/2 rounded-lg ${t?"flex":"hidden"}`,children:["Go to page"," ",e.jsx("input",{className:"ml-2 bg-white w-[30px] h-[20px] rounded-lg text-black text-center",type:"text","aria-label":"Page Number",defaultValue:"1"})]})]})})},As=({page:t,isActive:s,onClick:r})=>t==="..."?e.jsx("span",{className:"px-2 select-none",children:"..."}):e.jsx("span",{className:`cursor-pointer px-2 hover:text-white!  ${s?"active font-bold text-white! bg-[#914f03] text-base!":"text-gray-700!"}`,onClick:()=>r(Number(t)),children:t}),Is=()=>{const t=gt(),s=Me(),r=new URLSearchParams(s.search),[n,o]=l.useState(1),[c,h]=l.useState(10),[f,x]=l.useState(1),[d]=_("withParticipantsData",{defaultValue:!1}),[p]=_("fileDetails"),[y,q]=l.useState("main"),S=()=>{const A=new URLSearchParams(s.search).get("filter")||"main";return console.log("ACTIVE TAB: >>>>>",A),q(A),A};l.useEffect(()=>{S()},[s.search]);const P=m=>{m<1||m>f||(r.set("page",m.toString()),r.set("pageSize",c.toString()),t({search:r.toString()}))};l.useEffect(()=>{const m=parseInt(r.get("page")||"1",10),A=parseInt(r.get("pageSize")||"250",10);if(o(m),h(A),p){const T=Math.ceil(p.entries/A);x(T)}else x(1)},[r,p]);const B=()=>{const m=[];if(f<=7)for(let A=1;A<=f;A++)m.push(A);else n<=4?m.push(1,2,3,4,5,"...",f):n>=f-3?m.push(1,"...",f-4,f-3,f-2,f-1,f):m.push(1,"...",n-1,n,n+1,"...",f);return m};return e.jsxs("div",{className:`pagination bg-orange-200 rounded-full text-xs flex-row items-center h-[40px] ${d&&y=="main"?"flex":"hidden"}`,children:[e.jsx("button",{className:"hover:bg-orange-300 px-2 ps-3 h-[40px] rounded-r-lg cursor-pointer text-sm aspect-square overflow-hidden rounded-l-full","aria-label":"Previous Page",onClick:()=>P(n-1),disabled:n===1,children:e.jsx(me,{icon:yt})}),e.jsxs("div",{className:"pages flex flex-row items-center px-2",children:[B().map((m,A)=>e.jsx(As,{page:m,isActive:n===m,onClick:P},A)),e.jsx(Fs,{})]}),e.jsx("button",{type:"button",className:"hover:bg-orange-300 px-2 pe-3 h-[40px] rounded-l-lg cursor-pointer text-sm aspect-square overflow-hidden rounded-r-full","aria-label":"Next Page",onClick:()=>P(n+1),disabled:n===f,children:e.jsx(me,{icon:vt})})]})},Ws=(t,s)=>{const r=n=>{const o=n.getFullYear().toString().slice(-2),c=(n.getMonth()+1).toString().padStart(2,"0"),h=n.getDate().toString().padStart(2,"0");return`${o}${c}${h}`};return`${r(t)}_${r(s)}`},Ls=(t,s)=>{const r={month:"short",day:"numeric"},n=t.toLocaleDateString("en-US",r),c=s.getMonth()===t.getMonth()?{day:"numeric"}:{month:"short",day:"numeric"},h=s.toLocaleDateString("en-US",c),f=s.getFullYear();return`${n} to ${h}, ${f}`};function $s(t){const s=new Date,r=s.getDay(),n=r===0?-6:1-r,o=new Date(s);o.setDate(s.getDate()+n),o.setHours(0,0,0,0);const c=new Date(o);c.setDate(o.getDate()+6),c.setHours(23,59,59,999);const h=Ls(o,c),f=Ws(o,c);return{startingDate:o,endingDate:c,weekName:h,weekCode:f}}async function Bs(t){const s={api_url:`/winner-participants/${t}`,source:"client-app",destination:"cloud-server",type:"sync-remove-winner",payload:null,method_type:"DELETE",status:"pending",retry_count:0,error_message:null,priority:"medium",reference_id:null,content_type:"application/json",triggered_by:"system",is_test:!1,next_retry_at:null,headers:{},response_body:null,duration:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{return await Le("syncCloud",s),console.log("🗑️ Winner participant removal synced to queue:",s),!0}catch(r){return console.error("❌ Failed to queue winner participant removal:",r),!1}}async function Os(t,s){const r=await Ne();try{const n=r.transaction("winnerParticipant","readwrite"),o=n.objectStore("winnerParticipant"),c=await o.index("id_entry").getKey(t);if(!c)return console.warn(`No winner participant found with id_entry: ${t}`),!1;const h=await o.get(c);return!h||h.raffle_code!==s?(console.warn(`Raffle code does not match or participant not found for id_entry: ${t}`),!1):(await o.delete(c),await n.done,console.log(`Winner participant removed with id_entry: ${t} and raffle_code: ${s}`),await Bs(h.raffle_code),!0)}catch(n){return console.error("Error removing winner participant:",n),!1}}const Ms=({})=>{const t=async(D,v)=>{const k=await Os(v,D);k&&c(j=>j+1),console.log("Deletion: ",k)},s=Me(),[r,n]=_("withParticipantsData",{defaultValue:!1}),[o,c]=_("refreshTable",{defaultValue:0}),[h,f]=l.useState(null),[x,d]=l.useState(!1),[p,y]=l.useState("main"),[q,S]=l.useState(1),[P,B]=l.useState(250),m=()=>{const v=new URLSearchParams(s.search).get("filter")||"main";return console.log("ACTIVE TAB: >>>>>",v),y(v),v},A=()=>{const D=new URLSearchParams(s.search),v=parseInt(D.get("page")||"1",10),k=parseInt(D.get("pageSize")||"250",10);return S(v),B(k),{page:v,size:k}},T=(D,v)=>{t(D,v),O()},O=async()=>{d(!0);const D=m();console.log("Fetching data..."),d(!0);const{page:v,size:k}=A();try{let j=[];D==="winners"?(console.log("Winner table loading..."),await Be("primary")?j=await Oe("primary")||[]:console.log("No primary winners found.")):D==="backupwinners"?(console.log("Backup winners table loading..."),await Be("backup")?j=await Oe("backup")||[]:console.log("No backup winners found.")):(console.log("Main table loading..."),j=await Vt("WEEK-2025-06",v,k)||[]),f(j)}catch(j){console.error("Error fetching data:",j),f([])}finally{d(!1)}};return l.useEffect(()=>{O()},[r]),l.useEffect(()=>{O()},[o]),l.useEffect(()=>{d(!0),r?O():d(!1)},[]),l.useEffect(()=>{O()},[s.search]),e.jsx(e.Fragment,{children:h&&h.length>0&&!x?e.jsx("div",{className:"participants-table grow overflow-y-auto h-[500px]",children:e.jsxs("table",{className:"min-w-full table-fixed border-separate border-spacing-0",children:[e.jsx("thead",{className:"bg-[#bf4759] text-white sticky top-0 z-10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border-b w-[100px] text-center",children:"#:"}),e.jsx("th",{className:"p-2 text-center border-b w-[150px]",children:"Entry No:"}),e.jsx("th",{className:"p-2 text-left border-b w-[400px]",children:"Participant's Name"}),e.jsx("th",{className:"p-2 border-b text-center",children:"Code"}),e.jsx("th",{className:"p-2 border-b w-[200px] text-center",children:"Location"}),p!=="main"?e.jsxs(e.Fragment,{children:[e.jsx("th",{className:"p-2 text-left border-b w-[160px]",children:"Draw Date"}),e.jsx("th",{className:"p-2 text-left border-b",children:"Controls"})]}):e.jsx(e.Fragment,{children:e.jsx("th",{className:"p-2 text-left border-b",children:"Is Drawn"})})]})}),e.jsx("tbody",{className:"",children:h==null?void 0:h.map((D,v)=>{var k;return e.jsxs("tr",{className:"",children:[e.jsx("td",{className:"text-center",children:((q-1)*P+v+1).toLocaleString()}),e.jsxs("td",{className:"text-center font-mono",children:["#",(k=D.id_entry)==null?void 0:k.toString().padStart(8,"0").replace(/(\d{2})(\d{3})(\d{3})/,"$1-$2-$3")]}),e.jsx("td",{className:"",title:p!=="main"?`${D.full_name_raw}`:void 0,children:D.full_name||D.full_name_cleaned}),e.jsx("td",{className:"text-base font-bold",children:D.raffle_code}),e.jsx("td",{className:"text-center",children:D.regional_location}),p!=="main"?e.jsxs(e.Fragment,{children:[e.jsx("td",{children:new Date(D.draw_date).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"2-digit",weekday:"short"})}),e.jsx("td",{className:"",children:e.jsx("button",{onClick:()=>{T(D.raffle_code,D.id_entry)},className:"bg-red-700 text-white p-1 px-2 rounded-lg hover:bg-red-600 cursor-pointer",children:"Remove"})})]}):e.jsx(e.Fragment,{children:e.jsx("td",{children:D.is_drawn!=="false"&&"⭐"})})]},`participant-${D.id_entry}-${v}`)})})]})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"participants-table grow overflow-y-auto h-[500px] drop-shadow-none flex bg-gray-300 justify-center items-center text-center",children:x?e.jsxs("div",{className:"flex flex-col justify-center gap-4 items-center",children:[e.jsx("div",{className:"animate-spin bg-gray-200 h-[50px] w-[50px] aspect-square rounded-full relative",children:e.jsx("span",{className:"bg-gray-600 h-[10px] w-[10px] block rounded-full absolute top-1/2 left-[5px]"})}),"Loading New Data. Please wait..."]}):e.jsxs(e.Fragment,{children:["No data available... ",e.jsx("br",{}),"Upload new data to continue"]})})})})},zs=()=>{const t=Me(),[s,r]=l.useState(0),[n,o]=l.useState(1),[c,h]=l.useState(250),[f,x]=l.useState(1),[d,p]=l.useState(250),[y]=_("withParticipantsData",{defaultValue:!1}),q=()=>{const B=new URLSearchParams(t.search),m=parseInt(B.get("page")||"1",10),A=parseInt(B.get("pageSize")||"250",10);return{page:m,size:A}},S=()=>{s>c*n?p(c*n):p(s),n===1?(x(1),p(250)):x((n-1)*c+1)};l.useEffect(()=>{const{page:B,size:m}=q();o(B),h(m)},[t.search]),l.useEffect(()=>{S()},[n,c]);const[P]=_("fileDetails");return l.useEffect(()=>{P&&r(P==null?void 0:P.entries);const{page:B,size:m}=q();o(B),h(m)},[P]),l.useEffect(()=>{P&&r(P==null?void 0:P.entries);const{page:B,size:m}=q();o(B),h(m)},[]),e.jsx(e.Fragment,{children:e.jsxs("div",{className:`text-sm  items-center gap-2 ${y?"flex":"hidden"}`,children:["Showing Entries: ",e.jsxs("b",{className:"flex gap-2 items-baseline justify-center",children:["From"," ",e.jsx("span",{className:"bg-gray-700 min-w-[40px] flex  text-white p-2 py-1 rounded-md justify-center",children:f.toLocaleString()})," ","to"," ",e.jsx("span",{className:"bg-gray-700 min-w-[40px] flex  text-white p-2 py-1 rounded-md justify-center",children:d.toLocaleString()})," "]})]})})};async function _t(){const n=(await Ne()).transaction("syncCloud","readonly").objectStore("syncCloud").index("status_createdAt"),o=["pending","in-progress","failed","retrying","cancelled"];let c=null,h=1/0;for(const f of o){const x=IDBKeyRange.bound([f,""],[f,"￿"]),d=await n.openCursor(x,"next");if(d){const p=d.value,y=new Date(p.createdAt).getTime();y<h&&(c=p,h=y)}}return c}async function Qe(t){const o=await(await Ne()).transaction("syncCloud","readonly").objectStore("syncCloud").get(t);return o&&typeof o.id=="number"?o:null}async function Pe(t,s){const n=(await Ne()).transaction("syncCloud","readwrite"),o=n.objectStore("syncCloud"),c=await o.get(t);if(!c)throw new Error(`No syncCloud entry found with ID ${t}`);const h={...c,...s,updatedAt:new Date().toISOString()};await o.put(h),await n.done}async function Vs(t,s){var n,o;let r;if(t){if(r=await Qe(t),!r)return console.log(`🔍 Sync Queue Item #${t} not found`),!1}else if(r=await _t(),!r)return console.log("🔍 No pending down-sync items."),!1;try{console.log(`📥 Pulling from: ${r.api_url}...`);const c=r.method_type.toLowerCase(),h={headers:{"Content-Type":r.content_type||"application/json",...r.headers}},f=await We.request({url:r.api_url,method:c,...h}),x=f.data;return console.log("RESPONSE FROM SERVER:",x),f.status>=200&&f.status<300?(await s(x),await Pe(r.id,{status:"completed",response_body:x,error_message:null}),console.log(`✅ Down-sync completed for ID: ${r.id}`),!0):(await Pe(r.id,{status:"failed",response_body:x,error_message:null}),!1)}catch(c){return console.error("❌ Down-sync error:",c),await Pe(r.id,{status:"failed",error_message:((o=(n=c==null?void 0:c.response)==null?void 0:n.data)==null?void 0:o.error)||c.message||"Unknown error"}),!1}}async function Us(t){var r,n;let s;if(t){if(s=await Qe(t),!s)return console.log(`🔍 Sync Queue Item #${t} not found`),!1}else if(s=await _t(),!s)return console.log("🔍 No pending sync items."),!1;try{console.log(`📤 Syncing to: ${s.api_url}...`);const o=s.method_type.toLowerCase(),c={headers:{"Content-Type":s.content_type||"application/json",...s.headers}},h=await We.request({url:s.api_url,method:o,data:o==="get"||o==="delete"?void 0:{payload:s.payload},...c});s.payload=null;const f=h.data;return console.log("RESPONSE FROM SERVER: ",f),h.status>=200&&h.status<300?await Pe(s.id,{status:"completed",response_body:f,payload:null,error_message:null}):await Pe(s.id,{status:"failed",response_body:f,error_message:null}),h.status>=200&&h.status<300?(console.log(`✅ Sync completed for ID: ${s.id}`),!0):!1}catch(o){return console.error("❌ Sync error:",o),await Pe(s.id,{status:"failed",error_message:((n=(r=o==null?void 0:o.response)==null?void 0:r.data)==null?void 0:n.error)||o.message||"Unknown error"}),!1}}async function qs(t){const s=await Ne();try{const r=s.transaction("winnerParticipant","readwrite").objectStore("winnerParticipant"),{won_at:n,id_entry:o,...c}=t,h={...c,draw_date:n,id_entry:String(o)};return await r.add(h),console.log(`☁️ Synced winner participant from cloud: ${t.full_name}`),!0}catch(r){return console.error("❌ Error syncing winner participant from cloud:",r),!1}}const Hs=({itemId:t,onRemove:s,activeNth:r,handleSkipSync:n,handleNextSync:o,initialData:c})=>{const[h,f]=_("refreshTable",{defaultValue:0}),[x,d]=l.useState(!1),[p,y]=l.useState(!1),[q,S]=l.useState("Loading Data"),[P,B]=l.useState(!1),[m,A]=l.useState(null),T=l.useRef(null),O=l.useRef(null),D=async()=>{const j=await Qe(t);j&&A(j)},v=async j=>{switch(j.type){case"sync-down-winner":await Vs(j.id,qs)&&f(u=>u+1);break}},k=async()=>{y(!0);try{m.destination==="cloud-server"?await Us(t):(console.log("downsyncing..."),await v(m))}catch{n(t)}finally{y(!1)}};return l.useEffect(()=>{p||((m==null?void 0:m.status)==="completed"?(console.log("Removing sync item #",t),B(!0),S("Removing Item..."),o(t),O.current=setTimeout(()=>{s(t)},1e3)):x&&k())},[m]),l.useEffect(()=>(x?(T.current=setInterval(()=>{D()},1e3),S("Syncing...")):(T.current&&(clearInterval(T.current),T.current=null),S("Paused")),()=>{T.current&&(clearInterval(T.current),T.current=null)}),[x]),l.useEffect(()=>{d(r.includes(t))},[r]),l.useEffect(()=>(D(),()=>{T.current&&clearInterval(T.current),O.current&&clearTimeout(O.current)}),[]),e.jsxs("tr",{className:`transition-all overflow-hidden ${P?"h=[0px] bg-red-400 opacity-0 duration-700":"h-[30px] opacity-100"} ${p&&"!bg-green-800 text-white animate-pulse"}`,children:[e.jsx("td",{className:"px-4 py-2 text-center",children:(m==null?void 0:m.id)||c.id}),e.jsx("td",{className:"px-4 py-2 text-center flex justify-center items-center",children:(m==null?void 0:m.source)==="cloud-server"?e.jsxs(e.Fragment,{children:[e.jsx(me,{icon:wt,className:"pr-2"})," ","Downsync"]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{icon:Lt,className:"pr-2"})," Upsync"]})}),e.jsx("td",{className:"px-4 py-2 text-center uppercase",children:(m==null?void 0:m.method_type)||c.method_type}),e.jsx("td",{className:"px-4 py-2 text-center",children:(m==null?void 0:m.api_url)||c.api_url}),e.jsx("td",{className:"px-4 py-2 text-center",children:(m==null?void 0:m.status)||c.status}),e.jsx("td",{className:"px-4 py-2 text-center",children:q})]})};async function Ks(t,s){try{const c=(await Ne()).transaction("syncCloud","readonly").objectStore("syncCloud").index("status_createdAt"),h=["pending","in-progress","failed","retrying","cancelled"],f=[];for(const x of h){const d=IDBKeyRange.bound([x,""],[x,"￿"]);let p=await c.openCursor(d,"next");for(;p;){const y=p.value;if(y!=null&&y.id&&(!s||!s.includes(y.id))&&f.push({id:y.id}),t&&f.length>=t)return f;p=await p.continue()}if(t&&f.length>=t)return f}return f.length>0?f:null}catch(r){return console.error("Failed to fetch pending sync queue items:",r),null}}const Qs=()=>{const[t,s]=l.useState([]),[r,n]=l.useState([]),[o,c]=l.useState([]),[h,f]=l.useState(!1),[x,d]=l.useState(!0),[p,y]=_("isServerActive",{defaultValue:!1}),[q,S]=_("activeSyncsTotal",{defaultValue:0}),P=l.useRef(null),B=()=>{if(o.length>0&&p){const k=o.slice(0,10);n(k)}else n([])},m=v=>{s(k=>k.length>=10||k.some(j=>j.id===v)?k:[...k,{id:v}]),c(k=>k.length>=10||k.includes(v)?k:[...k,v])},A=v=>{T(v)},T=v=>{const k=setTimeout(()=>{o.length>0?c(j=>j.filter(a=>a.id!==v)):D(),clearTimeout(k)},1e3)},O=v=>{s(k=>k.filter(j=>j.id!==v)),c(k=>k.filter(j=>j!==v)),setTimeout(()=>{o.length<10&&D()},300)},D=async()=>{if(console.log("Checking for new queue items..."),o.length>=10){console.log("Max 10 sync items already active.");return}if(!h){f(!0);const k=10-o.length;if(k===0){f(!1);return}console.log("Attempting to get new data with total of ",k);const j=await Ks(k,o);j&&j.map(u=>u.id).sort((u,b)=>u-b).slice(0,k).filter(u=>!o.includes(u)).forEach(u=>{m(u)}),f(!1)}};return l.useEffect(()=>{S(o.length),o.length===0?(d(!1),n([])):(x||d(!0),n(o.slice(0,5))),o.length>0&&(r.length===0||r===void 0||r===null)&&B()},[o]),l.useEffect(()=>{!x&&o.length<5?P.current=setInterval(()=>{D()},2e3):P.current&&(clearInterval(P.current),P.current=null)},[x]),l.useEffect(()=>{p?B():n([])},[p]),l.useEffect(()=>{console.log("Cloud syncing activated"),B()},[]),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{children:"Syncing Queue Item:"}),r.map((v,k)=>e.jsxs("span",{className:"bg-green-800 text-white p-1 px-2 rounded-2xl",children:["#",v]},k))]}),e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("span",{children:"Total Items in Queue:"}),e.jsx("span",{className:"bg-green-800 text-white p-1 px-2 rounded-2xl min-w-[50px] text-center",children:o.length}),r.length<1&&o.length>0&&p&&e.jsx("button",{onClick:B,className:"cursor-pointer bg-amber-500 hover:bg-amber-600 p-1 px-2 rounded-2xl",children:"Trigger Sync"})]})]}),e.jsxs("table",{className:"mt-4 w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"bg-gray-300 px-4 py-2 font-bold w-[80px]",children:"ID #"}),e.jsx("th",{className:"bg-gray-300 px-4 py-2 font-bold w-[80px]",children:"Type"}),e.jsx("th",{className:"bg-gray-300 px-4 py-2",children:"Method"}),e.jsx("th",{className:"bg-gray-300 px-4 py-2",children:"Data API URL"}),e.jsx("th",{className:"bg-gray-300 px-4 py-2 w-[150px]",children:"Sync Status"}),e.jsx("th",{className:"bg-gray-300 px-4 py-2 w-[150px]",children:"Status"})]})}),e.jsxs("tbody",{className:"bg-red-300 grow",children:[t.map(v=>e.jsx(Hs,{itemId:v.id,onRemove:O,activeNth:r,handleSkipSync:A,handleNextSync:T,initialData:v},v.id)),t.length<=0&&e.jsx("tr",{className:"w-full grow !h-full",children:e.jsxs("td",{colSpan:6,children:["No queue items found to sync. Please refresh page to check for new items."," "]})})]})]})]})};async function Gs(t){const s={api_url:`/winner-participants/raffle-code/${t}`,source:"cloud-server",destination:"client-app",type:"sync-down-winner",payload:null,method_type:"GET",status:"pending",retry_count:0,error_message:null,priority:"medium",reference_id:null,content_type:"application/json",triggered_by:"system",is_test:!1,next_retry_at:null,headers:{},response_body:null,duration:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};try{return await Le("syncCloud",s),console.log("⬇️ Winner participant down-sync queued:",s),!0}catch(r){return console.error("❌ Failed to queue down-sync for winner participant:",r),!1}}const Ys=async()=>{try{return(await We.get("/winner-participants/all/raffle-codes")).data}catch(t){throw console.error("Error fetching winner participant raffle codes:",t),t}};async function Js(){try{return(await(await Ne()).transaction("winnerParticipant","readonly").objectStore("winnerParticipant").getAll()).map(n=>n==null?void 0:n.raffle_code).filter(n=>typeof n=="string")}catch(t){return console.error("❌ Failed to fetch raffle codes from winner participants:",t),[]}}async function Xs(){try{const n=(await Ne()).transaction("syncCloud","readonly").objectStore("syncCloud").index("type_createdAt"),o=IDBKeyRange.bound(["sync-down-winner",""],["sync-down-winner","￿"]),c=[];let h=await n.openCursor(o,"next");for(;h;){const x=h.value.api_url.match(/\/winner-participants\/raffle-code\/([^/]+)$/);x&&c.push(x[1]),h=await h.continue()}return c}catch(t){return console.error("❌ Failed to get queued down-sync raffle codes:",t),[]}}const Zs=()=>{const[t,s]=_("isServerActive",{defaultValue:!0}),[r,n]=_("hasSyncQueueList",{defaultValue:!0}),[o,c]=_("localParticipantsRaffleCodes",{defaultValue:[]}),[h,f]=_("withParticipantsData"),[x,d]=_("cloudSyncModalOpen",{defaultValue:!1}),[p,y]=l.useState(!1),q=l.useRef(t),S=l.useRef(0),P=l.useRef(!1);l.useEffect(()=>{q.current=t,t&&h&&B()},[t,h]);const B=async()=>{const T=await Ys();let O;const D=await Js(),v=await Xs();O=[...D,...v],c(O);const a=T.filter(i=>!O.includes(i)).forEach(i=>{Gs(i)});console.log("Queued for down-sync:",a)},m=async()=>{try{if((await We.get("/ping")).status===200)return console.log("✅ Server is back online."),s(!0),S.current=0,!0;console.log("🚫 Server response not 200.")}catch(T){console.error("❌ Error checking server:",T)}return s(!1),S.current+=1,console.log(`🔌 Attempt #${S.current} to reconnect...`),!1},A=async()=>{for(;!P.current;)await m(),await new Promise(T=>setTimeout(T,2e3))};return l.useEffect(()=>(P.current=!1,(async()=>{await Promise.all([A()])})(),()=>{P.current=!0}),[]),e.jsx("div",{className:`bg-[#33333393] z-[100] absolute top-0 left-0 w-screen h-screen justify-center items-center ${x?"flex":"hidden"}`,children:e.jsxs("div",{className:"modal bg-white h-[80%] aspect-[3/2] rounded-2xl drop-shadow-2xl drop-shadow-black flex flex-col gap-4 py-4",children:[e.jsxs("div",{className:"header px-4 flex justify-between",children:[e.jsx("h1",{className:"text-base font-bold",children:"Cloud Syncronizations (Backgroud Process)"}),e.jsx("button",{"aria-label":"close-modal",className:"bg-gray-700 text-white h-[30px] aspect-square rounded-full hover:bg-gray-500 cursor-pointer",onClick:()=>{d(!1)},children:e.jsx(me,{icon:$t})})]}),e.jsx("div",{className:"body  grow px-4 text-sm h-0 overflow-y-scroll",children:e.jsx(Qs,{})}),e.jsx("div",{className:"footer px-4 text-sm",children:t?e.jsx(e.Fragment,{children:e.jsx("span",{className:"text-emerald-600 animate-pulse",children:"Syncing everything to cloud..."})}):e.jsx(e.Fragment,{children:e.jsx("span",{className:"text-red-600",children:"Server is offline. Syncing is paused."})})})]})})};function on({}){return[{title:"KBNRDS | Dashboard"},{name:"description",content:"Welcome to Kopiko Blanca Raffle Draw System"}]}const xt=$s(),cn=Ct(function(){const[s,r]=l.useState(!0),[n,o]=_("fileDetails",{defaultValue:{entries:0}}),[c,h]=l.useState(!1),[f,x]=l.useState([]),[d,p]=l.useState(!1),y=Me(),[q,S]=_("selectedWeek",{defaultValue:xt}),[P,B]=_("withParticipantsData",{defaultValue:!1}),[m,A]=_("presentingStatus",{defaultValue:"not-presenting"}),T=()=>{r(v=>!v)},O=v=>new URLSearchParams(y.search).get("filter")===v,D=async()=>{console.log("Checking for Participants data FE"),await Ut()?(console.log("Participants Data Found!"),B(!0)):(console.log("NO Participants Data Found!"),B(!1))};return l.useEffect(()=>{h(m==="presenting")},[m]),l.useEffect(()=>{S(xt),D()},[]),e.jsxs(e.Fragment,{children:[e.jsx(Zs,{}),e.jsx(Xt,{isPresenting:c}),e.jsxs("div",{className:"dashboard flex w-full h-[calc(100vh-50px)]",children:[e.jsxs("main",{className:" main-panel  grow p-4 gap-4 flex flex-col",children:[e.jsxs("div",{className:"tabs flex justify-between items-center",children:[e.jsxs("ul",{className:"flex table-tabs",children:[e.jsx("li",{children:e.jsx(Ue,{to:"/main",className:()=>!O("winners")&&!O("backupwinners")?"active bg-orange-300":void 0,children:"All Participants"})}),e.jsx("li",{children:e.jsx(Ue,{to:"/main?filter=winners",className:()=>O("winners")?"active bg-orange-300":void 0,children:"Winners"})}),e.jsx("li",{children:e.jsx(Ue,{to:"/main?filter=backupwinners",className:()=>O("backupwinners")?"active bg-orange-300":void 0,children:"Backup Winners"})})]}),e.jsx(zs,{}),e.jsx("ul",{className:"flex space-x-4 text-sm",children:P&&e.jsxs("li",{className:"flex items-center justify-center h-full",children:["Total Participants for this week: ",e.jsx("b",{children:n==null?void 0:n.entries.toLocaleString()})]})})]}),e.jsx(Ms,{}),e.jsxs("div",{className:"status-bar flex justify-between items-center text-sm",children:[e.jsxs("div",{className:"week-selector flex gap-1 bg-orange-200 h-[40px]  items-center justify-center rounded-full overflow-hidden",children:[e.jsx("div",{className:"prev-week hover:bg-orange-300 h-full  px-4 content-center cursor-pointer",children:e.jsx(me,{icon:yt})}),e.jsxs("div",{className:"week-list hover:bg-orange-300 p-1 px-3 cursor-pointer rounded-full",children:["Week of ",q.weekName]}),e.jsx("div",{className:"next-week hover:bg-orange-300 h-full  px-4 content-center cursor-pointer",children:e.jsx(me,{icon:vt})})]}),e.jsx(Is,{}),e.jsx("button",{className:`control-panel-button flex gap-4 rounded-s-full cursor-pointer ${s?"-mr-4":"rounded-e-full"}`,onClick:T,type:"button",children:s?"Close Control Panel":"Open Control Panel"})]})]}),e.jsx(Ts,{controlPanelOpen:s,setIsPresenting:h,isPresenting:c})]})]})});export{cn as default,on as meta};
