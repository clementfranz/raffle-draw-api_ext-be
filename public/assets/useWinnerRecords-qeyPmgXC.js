import{r as u}from"./chunk-LSOULM7L-C51OxvVm.js";const o=new Map;function w(e,r){const a=r==null?void 0:r.serializer,[d]=u.useState(r==null?void 0:r.defaultValue),[i]=u.useState(r==null?void 0:r.defaultServerValue);return B(e,d,i,r==null?void 0:r.storageSync,a==null?void 0:a.parse,a==null?void 0:a.stringify)}function B(e,r,a,d=!0,i=I,g=JSON.stringify){const l=u.useRef({string:null,parsed:void 0}),f=u.useSyncExternalStore(u.useCallback(n=>{const t=p=>{e===p&&n()};return W.add(t),()=>{W.delete(t)}},[e]),()=>{const n=S(()=>localStorage.getItem(e))??null;if(o.has(e))l.current.parsed=o.get(e);else if(n!==l.current.string){let t;try{t=n===null?r:i(n)}catch{t=r}l.current.parsed=t}return l.current.string=n,r!==void 0&&n===null&&S(()=>{const t=g(r);localStorage.setItem(e,t),l.current={string:t,parsed:r}}),l.current.parsed},()=>a??r),c=u.useCallback(n=>{const t=n instanceof Function?n(l.current.parsed):n;try{localStorage.setItem(e,g(t)),o.delete(e)}catch{o.set(e,t)}b(e)},[e,g]),s=u.useCallback(()=>{S(()=>localStorage.removeItem(e)),o.delete(e),b(e)},[e]);return u.useEffect(()=>{if(!d)return;const n=t=>{t.key===e&&t.storageArea===S(()=>localStorage)&&b(e)};return window.addEventListener("storage",n),()=>window.removeEventListener("storage",n)},[e,d]),u.useMemo(()=>[f,c,{isPersistent:f===r||!o.has(e),removeItem:s}],[e,c,f,r,s])}const W=new Set;function b(e){for(const r of[...W])r(e)}function I(e){return e==="undefined"?void 0:JSON.parse(e)}function S(e){try{return e()}catch{}}const m={primary:null,backups:[null,null,null]},R=()=>{const[e,r]=w("winnerRecords",{defaultValue:m});return{winnerRecords:e,setWinnerRecords:r,setWinner:c=>{r(s=>({...s,primary:c}))},setBackupWinner:(c,s)=>{r(n=>{if(!n)return m;const t=[...n.backups];return t[c]=s,{...n,backups:t}})},resetWinners:()=>{r(m)},getFilledWinners:()=>({primary:!!e.primary,backups:e.backups.map(c=>!!c)}),clearBackup:c=>{r(s=>{if(!s)return m;const n=[...s.backups];return n[c]=null,{...s,backups:n}})},getWinnerByIndex:c=>c===0?e.primary:e.backups[c-1]||null}};export{R as a,w as u};
